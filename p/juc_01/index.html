<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="JUCï¼ˆjava.util.currentï¼‰å¤šçº¿ç¨‹ (ä¸€) 1. å¤šçº¿ç¨‹åŸºç¡€ 1.1 ç›®æ ‡ \u200b\tç†è§£å¤šçº¿ç¨‹æŠ€æœ¯çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚\n1.2 è·¯å¾„ å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨ çº¿ç¨‹å’Œè¿›ç¨‹çš„ä»‹ç» å¤šçº¿ç¨‹çš„åˆ›å»º ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ 1.3 è®²è§£ 1.3.1 å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨ \u200b\tä¸€ä¸ªé‡‡ç”¨äº†å¤šçº¿ç¨‹æŠ€æœ¯çš„åº”ç”¨ç¨‹åºå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚å…¶ä¸»è¦ä¼˜åŠ¿åœ¨äºå……åˆ†åˆ©ç”¨äº†CPUçš„ç©ºé—²æ—¶é—´ç‰‡ï¼Œå¯ä»¥ç”¨å°½å¯èƒ½å°‘çš„æ—¶é—´æ¥å¯¹ç”¨æˆ·çš„è¦æ±‚åšå‡ºå“åº”ï¼Œä½¿å¾—è¿›ç¨‹çš„æ•´ä½“è¿è¡Œæ•ˆç‡å¾—åˆ°è¾ƒå¤§æé«˜ï¼ŒåŒæ—¶å¢å¼ºäº†åº”ç”¨ç¨‹åºçš„çµæ´»æ€§ã€‚\n">
<title>JUC_01</title>

<link rel='canonical' href='https://mikeLing-qx.github.io/p/juc_01/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="JUC_01">
<meta property='og:description' content="JUCï¼ˆjava.util.currentï¼‰å¤šçº¿ç¨‹ (ä¸€) 1. å¤šçº¿ç¨‹åŸºç¡€ 1.1 ç›®æ ‡ \u200b\tç†è§£å¤šçº¿ç¨‹æŠ€æœ¯çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚\n1.2 è·¯å¾„ å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨ çº¿ç¨‹å’Œè¿›ç¨‹çš„ä»‹ç» å¤šçº¿ç¨‹çš„åˆ›å»º ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ 1.3 è®²è§£ 1.3.1 å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨ \u200b\tä¸€ä¸ªé‡‡ç”¨äº†å¤šçº¿ç¨‹æŠ€æœ¯çš„åº”ç”¨ç¨‹åºå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚å…¶ä¸»è¦ä¼˜åŠ¿åœ¨äºå……åˆ†åˆ©ç”¨äº†CPUçš„ç©ºé—²æ—¶é—´ç‰‡ï¼Œå¯ä»¥ç”¨å°½å¯èƒ½å°‘çš„æ—¶é—´æ¥å¯¹ç”¨æˆ·çš„è¦æ±‚åšå‡ºå“åº”ï¼Œä½¿å¾—è¿›ç¨‹çš„æ•´ä½“è¿è¡Œæ•ˆç‡å¾—åˆ°è¾ƒå¤§æé«˜ï¼ŒåŒæ—¶å¢å¼ºäº†åº”ç”¨ç¨‹åºçš„çµæ´»æ€§ã€‚\n">
<meta property='og:url' content='https://mikeLing-qx.github.io/p/juc_01/'>
<meta property='og:site_name' content='lexqinMike'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='å¹¶å‘ç¼–ç¨‹' /><meta property='article:tag' content='å¤šçº¿ç¨‹' /><meta property='article:tag' content='JUC' /><meta property='article:tag' content='è½¬è½½' /><meta property='article:published_time' content='2020-06-23T10:53:40&#43;08:00'/><meta property='article:modified_time' content='2020-06-23T10:53:40&#43;08:00'/>
<meta name="twitter:title" content="JUC_01">
<meta name="twitter:description" content="JUCï¼ˆjava.util.currentï¼‰å¤šçº¿ç¨‹ (ä¸€) 1. å¤šçº¿ç¨‹åŸºç¡€ 1.1 ç›®æ ‡ \u200b\tç†è§£å¤šçº¿ç¨‹æŠ€æœ¯çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚\n1.2 è·¯å¾„ å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨ çº¿ç¨‹å’Œè¿›ç¨‹çš„ä»‹ç» å¤šçº¿ç¨‹çš„åˆ›å»º ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ 1.3 è®²è§£ 1.3.1 å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨ \u200b\tä¸€ä¸ªé‡‡ç”¨äº†å¤šçº¿ç¨‹æŠ€æœ¯çš„åº”ç”¨ç¨‹åºå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚å…¶ä¸»è¦ä¼˜åŠ¿åœ¨äºå……åˆ†åˆ©ç”¨äº†CPUçš„ç©ºé—²æ—¶é—´ç‰‡ï¼Œå¯ä»¥ç”¨å°½å¯èƒ½å°‘çš„æ—¶é—´æ¥å¯¹ç”¨æˆ·çš„è¦æ±‚åšå‡ºå“åº”ï¼Œä½¿å¾—è¿›ç¨‹çš„æ•´ä½“è¿è¡Œæ•ˆç‡å¾—åˆ°è¾ƒå¤§æé«˜ï¼ŒåŒæ—¶å¢å¼ºäº†åº”ç”¨ç¨‹åºçš„çµæ´»æ€§ã€‚\n">
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avator_hu1060881492573662444.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">lexqinMike</a></h1>
            <h2 class="site-description">welcome to my blog, ä»£ç æ—  bugï¼Œå’–å•¡æ— é™ç»­ã€‚</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#jucjavautilcurrentå¤šçº¿ç¨‹-ä¸€">JUCï¼ˆjava.util.currentï¼‰å¤šçº¿ç¨‹ (ä¸€)</a>
      <ul>
        <li><a href="#1-å¤šçº¿ç¨‹åŸºç¡€">1. å¤šçº¿ç¨‹åŸºç¡€</a>
          <ul>
            <li><a href="#11-ç›®æ ‡">1.1 ç›®æ ‡</a></li>
            <li><a href="#12-è·¯å¾„">1.2 è·¯å¾„</a>
              <ul>
                <li>
                  <ul>
                    <li>
                      <ul>
                        <li><a href="#ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹">ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#13-è®²è§£">1.3 è®²è§£</a>
              <ul>
                <li><a href="#131-å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨">1.3.1 å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨</a></li>
                <li><a href="#132-çº¿ç¨‹å’Œè¿›ç¨‹">1.3.2 çº¿ç¨‹å’Œè¿›ç¨‹</a></li>
                <li><a href="#133-å¤šçº¿ç¨‹çš„åˆ›å»º">1.3.3 å¤šçº¿ç¨‹çš„åˆ›å»º</a>
                  <ul>
                    <li><a href="#1ç»§æ‰¿threadç±»">1.ç»§æ‰¿Threadç±»</a></li>
                    <li><a href="#2å®ç°runnableæ¥å£">2.å®ç°Runnableæ¥å£</a></li>
                    <li><a href="#3åŒ¿åå†…éƒ¨ç±»æ–¹å¼">3.åŒ¿åå†…éƒ¨ç±»æ–¹å¼</a></li>
                    <li><a href="#4å®ç°callableæ¥å£ä½¿ç”¨futuretask">4.å®ç°Callableæ¥å£ï¼Œä½¿ç”¨FutureTask</a></li>
                  </ul>
                </li>
                <li><a href="#134-ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹">1.3.4 ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹</a></li>
              </ul>
            </li>
            <li><a href="#14-å°ç»“">1.4 å°ç»“</a></li>
          </ul>
        </li>
        <li><a href="#2-çº¿ç¨‹å®‰å…¨">2 çº¿ç¨‹å®‰å…¨</a>
          <ul>
            <li><a href="#11-ç›®æ ‡-1">1.1 ç›®æ ‡</a></li>
            <li><a href="#12-è·¯å¾„-1">1.2 è·¯å¾„</a></li>
            <li><a href="#13-è®²è§£-1">1.3 è®²è§£</a>
              <ul>
                <li><a href="#131å–ç¥¨æ¡ˆä¾‹">1.3.1.å–ç¥¨æ¡ˆä¾‹</a></li>
                <li><a href="#132çº¿ç¨‹åŒæ­¥">1.3.2.çº¿ç¨‹åŒæ­¥</a></li>
                <li><a href="#133æ­»é”">1.3.3.æ­»é”</a></li>
              </ul>
            </li>
            <li><a href="#14-å°ç»“-1">1.4 å°ç»“</a></li>
          </ul>
        </li>
        <li><a href="#3-çº¿ç¨‹çŠ¶æ€">3 çº¿ç¨‹çŠ¶æ€</a>
          <ul>
            <li><a href="#11-ç›®æ ‡-2">1.1 ç›®æ ‡</a></li>
            <li><a href="#12-è·¯å¾„-2">1.2 è·¯å¾„</a></li>
            <li><a href="#13-è®²è§£-2">1.3 è®²è§£</a>
              <ul>
                <li><a href="#131çº¿ç¨‹çŠ¶æ€ä»‹ç»">1.3.1.çº¿ç¨‹çŠ¶æ€ä»‹ç»</a>
                  <ul>
                    <li><a href="#çº¿ç¨‹çŠ¶æ€å›¾">çº¿ç¨‹çŠ¶æ€å›¾</a></li>
                  </ul>
                </li>
                <li><a href="#132waitnotify">1.3.2.wait()ã€notify()</a></li>
                <li><a href="#133waitä¸sleepåŒºåˆ«">1.3.3.waitä¸sleepåŒºåˆ«</a></li>
                <li><a href="#134çº¿ç¨‹åœæ­¢">1.3.4.çº¿ç¨‹åœæ­¢</a>
                  <ul>
                    <li><a href="#151-è‡ªå®šä¹‰é€€å‡ºæ ‡å¿—">1.5.1 è‡ªå®šä¹‰é€€å‡ºæ ‡å¿—Â </a></li>
                    <li><a href="#152-ä½¿ç”¨interruptæ–¹æ³•">1.5.2 ä½¿ç”¨interrupt()æ–¹æ³•</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#14-å°ç»“-2">1.4 å°ç»“</a></li>
          </ul>
        </li>
        <li><a href="#4-çº¿ç¨‹ä¼˜å…ˆçº§">4 çº¿ç¨‹ä¼˜å…ˆçº§</a>
          <ul>
            <li><a href="#11-ç›®æ ‡-3">1.1 ç›®æ ‡</a></li>
            <li><a href="#12-è·¯å¾„-3">1.2 è·¯å¾„</a></li>
            <li><a href="#13-è®²è§£-3">1.3 è®²è§£</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#1ä¼˜å…ˆçº§priority">1.ä¼˜å…ˆçº§priority</a></li>
                    <li><a href="#2joinæ–¹æ³•">2.join()æ–¹æ³•</a></li>
                    <li><a href="#3yieldæ–¹æ³•running-ready">3.yieldæ–¹æ³•ï¼ˆrunning-&gt;readyï¼‰</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#14-å°ç»“-3">1.4 å°ç»“</a></li>
          </ul>
        </li>
        <li><a href="#5-å¤šçº¿ç¨‹å¹¶å‘çš„3ä¸ªç‰¹æ€§">5. å¤šçº¿ç¨‹å¹¶å‘çš„3ä¸ªç‰¹æ€§</a>
          <ul>
            <li><a href="#11-ç›®æ ‡-4">1.1 ç›®æ ‡</a></li>
            <li><a href="#12-è·¯å¾„-4">1.2 è·¯å¾„</a></li>
            <li><a href="#13-è®²è§£-4">1.3 è®²è§£</a>
              <ul>
                <li><a href="#131-åŸå­æ€§ä¸å¯åˆ†å‰²çš„æœ€å°å•ä½">1.3.1 åŸå­æ€§ï¼ˆä¸å¯åˆ†å‰²çš„æœ€å°å•ä½ï¼‰</a></li>
                <li><a href="#132-å¯è§æ€§">1.3.2 å¯è§æ€§</a></li>
                <li><a href="#133-æœ‰åºæ€§">1.3.3 æœ‰åºæ€§</a></li>
              </ul>
            </li>
            <li><a href="#14-å°ç»“-4">1.4 å°ç»“</a></li>
          </ul>
        </li>
        <li><a href="#6-javaå†…å­˜å¯è§æ€§">6. Javaå†…å­˜å¯è§æ€§</a>
          <ul>
            <li><a href="#11-ç›®æ ‡-5">1.1 ç›®æ ‡</a></li>
            <li><a href="#12-è·¯å¾„-5">1.2 è·¯å¾„</a></li>
            <li><a href="#13-è®²è§£-5">1.3 è®²è§£</a></li>
            <li><a href="#31-äº†è§£javaå†…å­˜æ¨¡å‹">3.1 äº†è§£Javaå†…å­˜æ¨¡å‹</a>
              <ul>
                <li><a href="#311-jvmå†…å­˜ç»“æ„-è¿è¡Œæ—¶æ•°æ®åŒº">3.1.1 JVMå†…å­˜ç»“æ„; è¿è¡Œæ—¶æ•°æ®åŒº</a></li>
                <li><a href="#312-javaå¯¹è±¡æ¨¡å‹">3.1.2 Javaå¯¹è±¡æ¨¡å‹</a></li>
                <li><a href="#313-å†…å­˜æ¨¡å‹">3.1.3 å†…å­˜æ¨¡å‹</a></li>
                <li><a href="#314-å°ç»“">3.1.4 å°ç»“</a></li>
              </ul>
            </li>
            <li><a href="#32-å†…å­˜å¯è§æ€§">3.2 å†…å­˜å¯è§æ€§</a>
              <ul>
                <li><a href="#321-å†…å­˜å¯è§æ€§ä»‹ç»">3.2.1 å†…å­˜å¯è§æ€§ä»‹ç»</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#7-volatile">7 Volatile</a>
          <ul>
            <li><a href="#71-ç›®æ ‡">7.1 ç›®æ ‡</a></li>
            <li><a href="#72-è·¯å¾„">7.2 è·¯å¾„</a></li>
            <li><a href="#73-è®²è§£">7.3 è®²è§£</a>
              <ul>
                <li><a href="#1-è§£å†³å†…å­˜å¯è§æ€§é—®é¢˜">1 è§£å†³å†…å­˜å¯è§æ€§é—®é¢˜</a>
                  <ul>
                    <li><a href="#11-ç¼“å­˜ä¸€è‡´åè®®ä¿è¯è¯»åˆ°æœ€æ–°å€¼">1.1 ç¼“å­˜ä¸€è‡´åè®®ä¿è¯è¯»åˆ°æœ€æ–°å€¼</a></li>
                    <li><a href="#12-å†…å­˜å±éšœé˜²æ­¢æŒ‡ä»¤é‡æ’è§£å†³æŒ‡ä»¤é‡æ’å¯¹volatileä¿®é¥°çš„å˜é‡ä¸ä¼šäº§ç”Ÿå½±å“">1.2 å†…å­˜å±éšœé˜²æ­¢æŒ‡ä»¤é‡æ’ï¼ˆè§£å†³æŒ‡ä»¤é‡æ’å¯¹volatileä¿®é¥°çš„å˜é‡ä¸ä¼šäº§ç”Ÿå½±å“ï¼‰</a></li>
                  </ul>
                </li>
                <li><a href="#2-åŸå­æ€§çš„é—®é¢˜">2 åŸå­æ€§çš„é—®é¢˜</a></li>
                <li><a href="#3-volatile-é€‚åˆä½¿ç”¨åœºæ™¯èƒ½å¤Ÿè§£å†³å¯è§æ€§å’Œä¸€å®šç¨‹åº¦çš„æœ‰åºæ€§ä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§">3 Volatile é€‚åˆä½¿ç”¨åœºæ™¯ï¼ˆèƒ½å¤Ÿè§£å†³å¯è§æ€§ï¼Œå’Œä¸€å®šç¨‹åº¦çš„æœ‰åºæ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§ï¼‰</a></li>
              </ul>
            </li>
            <li><a href="#74-å°ç»“">7.4 å°ç»“</a></li>
          </ul>
        </li>
        <li><a href="#8-synchronized">8. synchronized</a>
          <ul>
            <li><a href="#81-ç›®æ ‡">8.1 ç›®æ ‡</a></li>
            <li><a href="#82-è·¯å¾„">8.2 è·¯å¾„</a></li>
            <li><a href="#83-è®²è§£">8.3 è®²è§£</a>
              <ul>
                <li><a href="#831-è§£å†³å¯è§æ€§é—®é¢˜">8.3.1 è§£å†³å¯è§æ€§é—®é¢˜</a></li>
                <li><a href="#832-åŒæ­¥åŸç†">8.3.2 åŒæ­¥åŸç†</a></li>
                <li><a href="#833-synchronizedå’Œvolatileæ¯”è¾ƒ">8.3.3 synchronizedå’Œvolatileæ¯”è¾ƒ</a></li>
                <li><a href="#834-é”ä¼˜åŒ–">8.3.4 é”ä¼˜åŒ–</a>
                  <ul>
                    <li><a href="#1-åå‘é”">1 åå‘é”</a></li>
                    <li><a href="#2-è½»é‡çº§é”">2 è½»é‡çº§é”</a></li>
                    <li><a href="#3-è‡ªæ—‹é”">3 è‡ªæ—‹é”</a></li>
                    <li><a href="#4-é€‚åº”è‡ªæ—‹é”">4 é€‚åº”è‡ªæ—‹é”</a></li>
                    <li><a href="#5-é”æ¶ˆé™¤">5 é”æ¶ˆé™¤</a></li>
                    <li><a href="#6-é”ç²—åŒ–">6 é”ç²—åŒ–</a></li>
                    <li><a href="#7-é‡é‡é”">7 é‡é‡é”</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/juc/" >
                JUC
            </a>
        
            <a href="/categories/%E8%BD%AC%E8%BD%BD/" >
                è½¬è½½
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/juc_01/">JUC_01</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 23, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 53 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="jucjavautilcurrentå¤šçº¿ç¨‹-ä¸€">JUCï¼ˆjava.util.currentï¼‰å¤šçº¿ç¨‹ (ä¸€)
</h1><h2 id="1-å¤šçº¿ç¨‹åŸºç¡€">1. å¤šçº¿ç¨‹åŸºç¡€
</h2><h3 id="11-ç›®æ ‡">1.1 ç›®æ ‡
</h3><p>â€‹	ç†è§£å¤šçº¿ç¨‹æŠ€æœ¯çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p>
<h3 id="12-è·¯å¾„">1.2 è·¯å¾„
</h3><ol>
<li>å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨</li>
<li>çº¿ç¨‹å’Œè¿›ç¨‹çš„ä»‹ç»</li>
<li>å¤šçº¿ç¨‹çš„åˆ›å»º</li>
<li>
<h6 id="ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹">ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹
</h6></li>
</ol>
<h3 id="13-è®²è§£">1.3 è®²è§£
</h3><h4 id="131-å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨">1.3.1 å¤šçº¿ç¨‹çš„æ¦‚å¿µåŠä½œç”¨
</h4><p>â€‹	    ä¸€ä¸ªé‡‡ç”¨äº†å¤šçº¿ç¨‹æŠ€æœ¯çš„åº”ç”¨ç¨‹åºå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚å…¶ä¸»è¦ä¼˜åŠ¿åœ¨äºå……åˆ†åˆ©ç”¨äº†CPUçš„ç©ºé—²æ—¶é—´ç‰‡ï¼Œå¯ä»¥ç”¨å°½å¯èƒ½å°‘çš„æ—¶é—´æ¥å¯¹ç”¨æˆ·çš„è¦æ±‚åšå‡ºå“åº”ï¼Œä½¿å¾—è¿›ç¨‹çš„æ•´ä½“è¿è¡Œæ•ˆç‡å¾—åˆ°è¾ƒå¤§æé«˜ï¼ŒåŒæ—¶å¢å¼ºäº†åº”ç”¨ç¨‹åºçš„çµæ´»æ€§ã€‚</p>
<p>â€‹	   æ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œç”±äºåŒä¸€è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹æ˜¯å…±äº«åŒä¸€å†…å­˜ï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹æ®Šçš„æ•°æ®ä¼ é€æœºåˆ¶ï¼Œä¸éœ€è¦å»ºç«‹å…±äº«å­˜å‚¨åŒºæˆ–å…±äº«æ–‡ä»¶ï¼Œä»è€Œä½¿å¾—ä¸åŒä»»åŠ¡ä¹‹é—´çš„åè°ƒæ“ä½œä¸è¿è¡Œã€æ•°æ®çš„äº¤äº’ã€èµ„æºçš„åˆ†é…ç­‰é—®é¢˜æ›´åŠ æ˜“äºè§£å†³ã€‚</p>
<p>â€‹	   <strong>ç®€å•è¯´ï¼Œå¤šçº¿ç¨‹å°±æ˜¯ä»¥ç©ºé—´ï¼ˆcpuçš„å ç”¨ï¼‰æ¢æ—¶é—´(å“åº”æ—¶é—´)ï¼ŒæœŸæœ›ä»¥æ›´å¤šçš„èµ„æºæ¶ˆè€—ï¼ˆcpuï¼‰æ¥å‡å°‘å“åº”æ—¶é—´ï¼Œæé«˜æ‰§è¡Œé€Ÿåº¦çš„æŠ€æœ¯ã€‚</strong></p>
<h4 id="132-çº¿ç¨‹å’Œè¿›ç¨‹">1.3.2 çº¿ç¨‹å’Œè¿›ç¨‹
</h4><ul>
<li><strong>è¿›ç¨‹ï¼š</strong></li>
</ul>
<p>â€‹	æ˜¯æŒ‡ä¸€ä¸ªå†…å­˜ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª<strong>ç‹¬ç«‹çš„å†…å­˜ç©ºé—´</strong>ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼›è¿›ç¨‹ä¹Ÿæ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼›ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚</p>
<ul>
<li><strong>çº¿ç¨‹ï¼š</strong></li>
</ul>
<p>â€‹	è¿›ç¨‹å†…éƒ¨çš„ä¸€ä¸ªç‹¬ç«‹æ‰§è¡Œå•å…ƒï¼›ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶å¹¶å‘çš„è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¿›ç¨‹ä¾¿ç›¸å½“äºä¸€ä¸ªå• CPU æ“ä½œç³»ç»Ÿï¼Œè€Œçº¿ç¨‹ä¾¿æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­è¿è¡Œçš„å¤šä¸ªä»»åŠ¡ã€‚</p>
<ul>
<li><strong>è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«ï¼š</strong></li>
</ul>
<p>â€‹	è¿›ç¨‹ï¼šæœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿›ç¨‹ä¸­çš„æ•°æ®å­˜æ”¾ç©ºé—´ï¼ˆå †ç©ºé—´å’Œæ ˆç©ºé—´ï¼‰æ˜¯ç‹¬ç«‹çš„ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>â€‹	çº¿ç¨‹ï¼šå †ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ ˆç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œçº¿ç¨‹æ¶ˆè€—çš„èµ„æºæ¯”è¿›ç¨‹å°çš„å¤šã€‚</p>
<ol>
<li>å †ç©ºé—´:   å­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„çš„å†…å­˜åŒºåŸŸ</li>
<li>æ ˆç©ºé—´:  ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å’Œè¿”å›åœ°å€,  æ ˆçš„å¤§å°é€šå¸¸åœ¨çº¿ç¨‹åˆ›å»ºæ—¶ç¡®å®šï¼Œå¹¶åœ¨çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜</li>
</ol>
<ul>
<li><strong>æ³¨æ„ï¼š</strong></li>
</ul>
<ol>
<li>å› ä¸ºä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹æ˜¯å¹¶å‘è¿è¡Œçš„ï¼Œé‚£ä¹ˆä»å¾®è§‚è§’åº¦çœ‹ä¹Ÿæ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå“ªä¸ªçº¿ç¨‹æ‰§è¡Œå®Œå…¨å–å†³äº
CPU çš„è°ƒåº¦ï¼Œç¨‹åºå‘˜æ˜¯ä¸èƒ½å®Œå…¨æ§åˆ¶çš„ï¼ˆå¯ä»¥è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼‰ã€‚è€Œè¿™ä¹Ÿå°±é€ æˆçš„å¤šçº¿ç¨‹çš„éšæœºæ€§ã€‚</li>
<li>Java ç¨‹åºçš„è¿›ç¨‹é‡Œé¢è‡³å°‘åŒ…å«ä¸¤ä¸ªçº¿ç¨‹ï¼Œ==ä¸»çº¿ç¨‹ä¹Ÿå°±æ˜¯ main()æ–¹æ³•çº¿ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åƒåœ¾å›æ”¶æœºåˆ¶çº¿ç¨‹==ã€‚æ¯
å½“ä½¿ç”¨ java å‘½ä»¤æ‰§è¡Œä¸€ä¸ªç±»æ—¶ï¼Œå®é™…ä¸Šéƒ½ä¼šå¯åŠ¨ä¸€ä¸ª JVMï¼Œæ¯ä¸€ä¸ª JVM å®é™…ä¸Šå°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­å¯åŠ¨äº†ä¸€ä¸ª
çº¿ç¨‹ï¼Œjava æœ¬èº«å…·å¤‡äº†åƒåœ¾çš„æ”¶é›†æœºåˆ¶ï¼Œæ‰€ä»¥åœ¨ Java è¿è¡Œæ—¶è‡³å°‘ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ã€‚</li>
<li>ç”±äºåˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å¼€é”€æ¯”åˆ›å»ºä¸€ä¸ªè¿›ç¨‹çš„å¼€é”€å°çš„å¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å¼€å‘å¤šä»»åŠ¡è¿è¡Œçš„æ—¶å€™ï¼Œé€šå¸¸è€ƒè™‘åˆ›å»º
å¤šçº¿ç¨‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤šè¿›ç¨‹ã€‚</li>
</ol>
<h4 id="133-å¤šçº¿ç¨‹çš„åˆ›å»º">1.3.3 å¤šçº¿ç¨‹çš„åˆ›å»º
</h4><p>åˆ›å»ºMavenå·¥ç¨‹ï¼Œç¼–å†™æµ‹è¯•ç±»</p>
<h5 id="1ç»§æ‰¿threadç±»">1.ç»§æ‰¿Threadç±»
</h5><p>â€‹	ç¬¬ä¸€ç§ç»§æ‰¿Threadç±» é‡å†™runæ–¹æ³•</p>
<pre><code class="language-java">public class Demo1CreateThread extends Thread {

    public static void main(String[] args) throws InterruptedException {

        System.out.println(&quot;-----å¤šçº¿ç¨‹åˆ›å»ºå¼€å§‹-----&quot;);
        // 1.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹
        CreateThread createThread1 = new CreateThread();
        CreateThread createThread2 = new CreateThread();
        // 2.å¼€å§‹æ‰§è¡Œçº¿ç¨‹ æ³¨æ„ å¼€å¯çº¿ç¨‹ä¸æ˜¯è°ƒç”¨runæ–¹æ³•ï¼Œè€Œæ˜¯startæ–¹æ³•
        System.out.println(&quot;-----å¤šçº¿ç¨‹åˆ›å»ºå¯åŠ¨-----&quot;);
        createThread1.start();
        createThread2.start();
        System.out.println(&quot;-----å¤šçº¿ç¨‹åˆ›å»ºç»“æŸ-----&quot;);
    }

    static class CreateThread extends Thread {
        public void run() {
            String name = Thread.currentThread().getName();
            for (int i = 0; i &lt; 5; i++) {
                System.out.println(name + &quot;æ‰“å°å†…å®¹æ˜¯:&quot; + i);
            }
        }
    }
}
</code></pre>
<h5 id="2å®ç°runnableæ¥å£">2.å®ç°Runnableæ¥å£
</h5><p>â€‹	å®ç°Runnableæ¥å£,é‡å†™runæ–¹æ³•</p>
<p>â€‹	å®é™…ä¸Šæ‰€æœ‰çš„å¤šçº¿ç¨‹ä»£ç éƒ½æ˜¯é€šè¿‡è¿è¡ŒThreadçš„start()æ–¹æ³•æ¥è¿è¡Œçš„ã€‚å› æ­¤ï¼Œä¸ç®¡æ˜¯ç»§æ‰¿Threadç±»è¿˜æ˜¯å®ç°Runnableæ¥å£æ¥å®ç°å¤šçº¿ç¨‹ï¼Œæœ€ç»ˆè¿˜æ˜¯é€šè¿‡Threadçš„å¯¹è±¡çš„APIæ¥æ§åˆ¶çº¿ç¨‹çš„ã€‚</p>
<pre><code class="language-java">public class Demo2CreateRunnable {

    public static void main(String[] args) {
        System.out.println(&quot;-----å¤šçº¿ç¨‹åˆ›å»ºå¼€å§‹-----&quot;);
        // 1.åˆ›å»ºçº¿ç¨‹
        CreateRunnable createRunnable = new CreateRunnable();
        Thread thread1 = new Thread(createRunnable);
        Thread thread2 = new Thread(createRunnable);
        // 2.å¼€å§‹æ‰§è¡Œçº¿ç¨‹ æ³¨æ„ å¼€å¯çº¿ç¨‹ä¸æ˜¯è°ƒç”¨runæ–¹æ³•ï¼Œè€Œæ˜¯startæ–¹æ³•
        System.out.println(&quot;-----å¤šçº¿ç¨‹åˆ›å»ºå¯åŠ¨-----&quot;);
        thread1.start();
        thread2.start();
        System.out.println(&quot;-----å¤šçº¿ç¨‹åˆ›å»ºç»“æŸ-----&quot;);
    }

    static class CreateRunnable implements Runnable {

        public void run() {
            String name = Thread.currentThread().getName();
            for (int i = 0; i &lt; 5; i++) {
                System.out.println(name + &quot;çš„å†…å®¹:&quot; + i);
            }
        }
    }
}
</code></pre>
<blockquote>
<p>å®ç°Runnableæ¥å£æ¯”ç»§æ‰¿Threadç±»æ‰€å…·æœ‰çš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li>==é€‚åˆå¤šä¸ªç›¸åŒçš„ç¨‹åºä»£ç çš„çº¿ç¨‹å»å…±äº«åŒä¸€ä¸ªèµ„æº==ã€‚</li>
<li>==å¯ä»¥é¿å…javaä¸­çš„å•ç»§æ‰¿çš„å±€é™æ€§==ã€‚</li>
<li>å¢åŠ ç¨‹åºçš„å¥å£®æ€§ï¼Œå®ç°è§£è€¦æ“ä½œï¼Œ==ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä»£ç å’Œæ•°æ®ç‹¬ç«‹==ã€‚</li>
</ol>
</blockquote>
<h5 id="3åŒ¿åå†…éƒ¨ç±»æ–¹å¼">3.åŒ¿åå†…éƒ¨ç±»æ–¹å¼
</h5><p>â€‹	ä½¿ç”¨çº¿ç¨‹çš„å†…åŒ¿åå†…éƒ¨ç±»æ–¹å¼ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸åŒçš„çº¿ç¨‹ä»»åŠ¡æ“ä½œ</p>
<pre><code class="language-java">public class Demo3Runnable {
    public static boolean exit = true;

    public static void main(String[] args) throws InterruptedException {
        new Thread(new Runnable() {
            public void run() {
                String name = Thread.currentThread().getName();
                for (int i = 0; i &lt; 5; i++) {
                    System.out.println(name + &quot;æ‰§è¡Œå†…å®¹ï¼š&quot; + i);
                }
            }
        }).start();

        new Thread(new Runnable() {
            public void run() {
                String name = Thread.currentThread().getName();
                for (int i = 0; i &lt; 5; i++) {
                    System.out.println(name + &quot;æ‰§è¡Œå†…å®¹ï¼š&quot; + i);
                }
            }
        }).start();

        Thread.sleep(1000l);
    }
}}
</code></pre>
<p>ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†åˆ›å»ºå¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼å®ç°Runnableæ¥å£å’Œç»§æ‰¿Threadç±»ï¼Œæ¥ä¸‹æ¥çœ‹è¿™ä¸ªdemo</p>
<pre><code class="language-java">	static Integer num = 0;
    public static void main(String[] args) {
     	Runnable runnable = new Runnable() {
            @Override
            public void run() {
                while (num&lt;10000){
                    num++;
                }
            }
        };
        new Thread(runnable).start();
        //TODOã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
    }
</code></pre>
<p>æˆ‘ä»¬æƒ³è¦è·å–è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹ånumçš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ç¡®å®šçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•äº†å‘¢,å½“ç„¶æˆ‘ä»¬å¯ä»¥ç­‰å¾…ä¸€æ®µæ—¶é—´è®©çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä½†æ˜¯ç­‰å¾…å¤šä¹…å‘¢ï¼Œå¾ˆéš¾ä¼°è®¡ä¸€ä¸ªå‡†ç¡®çš„æ—¶é—´ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ã€‚å½“ç„¶æœ‰ï¼Œå¯ä»¥ä½¿ç”¨Callableæ¥å£å’ŒFutureTaskæ¥è§£å†³ã€‚</p>
<h5 id="4å®ç°callableæ¥å£ä½¿ç”¨futuretask">4.å®ç°Callableæ¥å£ï¼Œä½¿ç”¨FutureTask
</h5><p>æ”¹é€ ä¸Šé¢çš„æ¡ˆä¾‹</p>
<pre><code class="language-java">	static Integer num = 0;
    public static void main(String[] args) {
       Callable&lt;String&gt; callableTask = new Callable(){
            @Override
            public String call() throws Exception {
                while (num&lt;10000){
                    num++;
                }
                return &quot;ok&quot;;
            }
        };
        FutureTask&lt;String&gt; stringFutureTask = new FutureTask(callableTask);

        new Thread(stringFutureTask).start();

        try {
            if(&quot;ok&quot;.equals(stringFutureTask.get())){
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        }
        System.out.println(num);
     }
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä¼˜é›…çš„æ‹¿åˆ°ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç»“æœäº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¤šä¸ªçº¿ç¨‹å‘¢ï¼Œåˆè¯¥å¦‚ä½•è§£å†³çº¿ç¨‹æ‰§è¡Œå®Œæ¯•çš„é€šçŸ¥è¡Œä¸ºå‘¢ï¼Ÿ</p>
<pre><code class="language-java">    static Integer num = 0;
    public static void main(String[] args) {
        Callable&lt;String&gt; callableTask = new Callable(){
            @Override
            public String call() throws Exception {
                while (num&lt;10000){
                    //System.out.println(Thread.currentThread().getName());
                    num++;
                }
                return &quot;ok&quot;;
            }
        };
        FutureTask&lt;String&gt; stringFutureTask = new FutureTask(callableTask);

        for (int i = 0; i &lt; 10; i++) {
            new Thread(stringFutureTask).start();
        }

        try {
            if(&quot;ok&quot;.equals(stringFutureTask.get())){
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        }

        System.out.println(num);
    }
</code></pre>
<p>æˆ‘ä»¬ç”¨10ä¸ªçº¿ç¨‹æ¨¡æ‹Ÿè·å–å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„æ‰§è¡Œç»“æœï¼Œçœ‹èµ·æ¥ä»£ç å¥½åƒæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå–æ¶ˆSystem.out.println(Thread.currentThread().getName());çš„æ³¨é‡Šï¼Œä½ ä¼šå‘ç°ï¼Œä¸€ç›´æ˜¯åŒä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œè¯´å¥½çš„å¤šçº¿ç¨‹å‘¢ï¼Ÿé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ç¿»å¼€FutureTaskçš„æºç ï¼Œèƒ½å¤Ÿä½œä¸ºThreadçš„å‚æ•°ï¼Œé‚£ä¹ˆå®ƒå¿…æ˜¯ä¸€ä¸ªrunnableæ¥å£çš„å®ç°ç±»ï¼Œæˆ‘ä»¬ç›´æ¥æ‰¾å®ƒçš„runæ–¹æ³•ï¼š</p>
<pre><code class="language-java">public void run() {
        if (state != NEW ||
            //è¿™é‡Œæ˜¯ä¸€ä¸ªcasæ–¹æ³•ï¼Œæ„å‘³ç€åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œcallableçš„callæ–¹æ³•ã€‚
            !UNSAFE.compareAndSwapObject(this, runnerOffset,
                                         null, Thread.currentThread()))
            return;
        try {
            Callable&lt;V&gt; c = callable;
            if (c != null &amp;&amp; state == NEW) {
                V result;
                boolean ran;
                try {
                    result = c.call();
                    ran = true;
                } catch (Throwable ex) {
                    result = null;
                    ran = false;
                    setException(ex);
                }
                if (ran)
                    set(result);
            }
        } finally {
            // runner must be non-null until state is settled to
            // prevent concurrent calls to run()
            runner = null;
            // state must be re-read after nulling runner to prevent
            // leaked interrupts
            int s = state;
            if (s &gt;= INTERRUPTING)
                handlePossibleCancellationInterrupt(s);
        }
    }
</code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬å‘ç°futureTaskå¹¶ä¸èƒ½æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå®ƒåªèƒ½æ”¯æŒ<strong>ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç»“æœ</strong>æ—¶ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•è§£å†³å¤šçº¿ç¨‹çš„å¼‚æ­¥é€šçŸ¥é—®é¢˜å‘¢ï¼Œè¿™ä¸ªæˆ‘ä»¬åˆ°ä¹‹åå­¦ä¹ äº†jucçš„CASï¼ŒAQSä»¥åŠä¸€äº›å·¥å…·ç±»ä¹‹åå†å›æ¥æ€è€ƒï¼Œå…ˆæŒ–ä¸€ä¸ªå‘åœ¨è¿™é‡Œã€‚</p>
<h4 id="134-ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹">1.3.4 ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹
</h4><p>Javaä¸­æœ‰ä¸¤ç§çº¿ç¨‹ï¼Œä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå¦ä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</p>
<p>ç”¨æˆ·çº¿ç¨‹æ˜¯æŒ‡ç”¨æˆ·è‡ªå®šä¹‰åˆ›å»ºçš„çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹åœæ­¢ï¼Œç”¨æˆ·çº¿ç¨‹ä¸ä¼šåœæ­¢ã€‚</p>
<p>å®ˆæŠ¤çº¿ç¨‹å½“è¿›ç¨‹ä¸å­˜åœ¨æˆ–ä¸»çº¿ç¨‹åœæ­¢ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šè¢«åœæ­¢ã€‚</p>
<pre><code class="language-java">public class Demo4Daemon {
    public static void main(String[] args) {
        Thread thread = new Thread(new Runnable() {
            public void run() {
                for (int i = 0; i &lt; 10; i++) {
                    try {
                        Thread.sleep(10);
                    } catch (Exception e) {
                    }
                    System.out.println(&quot;å­çº¿ç¨‹...&quot; + i);
                }
            }
        });
		
        // è®¾ç½®çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹
        //thread.setDaemon(true);
        thread.start();

        for (int i = 0; i &lt; 5; i++) {
            try {
                Thread.sleep(10);
                System.out.println(&quot;ä¸»çº¿ç¨‹&quot; + i);
            } catch (Exception e) {

            }
        }

        System.out.println(&quot;ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•!&quot;);
    }
}
</code></pre>
<h3 id="14-å°ç»“">1.4 å°ç»“
</h3><p>å¤šçº¿ç¨‹ï¼šé€šè¿‡ç©ºé—´ï¼ˆcpuçš„æ—¶é—´ç‰‡çš„åˆ©ç”¨ï¼‰æ¢å–å“åº”æ—¶é—´</p>
<p>çº¿ç¨‹å’Œè¿›ç¨‹çš„æ¦‚å¿µ</p>
<ul>
<li>è¿›ç¨‹ï¼šç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼Œè¿›ç¨‹ä¹‹é—´å†…å­˜æ˜¯ç‹¬ç«‹çš„ï¼Œæ— æ³•å…±äº«å†…å­˜ç©ºé—´ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li>
<li>çº¿ç¨‹ï¼šè¿›ç¨‹å†…éƒ¨çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«å †å†…å­˜ï¼Œæ ˆå†…å­˜æ˜¯ç‹¬ç«‹çš„ã€‚</li>
</ul>
<p>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</p>
<ul>
<li>ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•</li>
<li>å®ç°Runnableæ¥å£ï¼Œå®ç°é‡Œé¢çš„runæ–¹æ³•</li>
<li>åŒ¿åå†…éƒ¨ç±»å®ç°Runnableæ¥å£ï¼ŒNew Thread(()-&gt;æ‰§è¡Œå†…å®¹)</li>
</ul>
<p>çº¿ç¨‹çš„æ‰§è¡Œï¼šä¸€å®šè¦ç”¨Startæ–¹æ³•æ‰§è¡Œçº¿ç¨‹ï¼Œå¦‚æœrunæ–¹æ³•æ‰§è¡Œæ˜¯ç›´æ¥æ‰§è¡Œç±»çš„æ–¹æ³•ï¼Œä¸ä¼šä»¥çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œ</p>
<p>ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ï¼š</p>
<ul>
<li>
<p>ç”¨æˆ·çº¿ç¨‹ï¼šä¸€èˆ¬æ˜¯ç”¨æˆ·åˆ›å»ºçš„ï¼Œä¸ä¼šéšç€ä¸»çº¿ç¨‹çš„ç»ˆæ­¢è€Œç»ˆæ­¢</p>
</li>
<li>
<p>å®ˆæŠ¤çº¿ç¨‹ï¼šä¸€èˆ¬æ˜¯ç³»ç»Ÿåˆ›å»ºçš„ï¼Œä¼šéšç€ä¸»çº¿çš„ç»ˆæ­¢è€Œç»ˆæ­¢ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨Thread::setDaemonæ–¹æ³•å°†ç”¨æˆ·çº¿ç¨‹è½¬åŒ–ä¸ºå®ˆæŠ¤çº¿ç¨‹</p>
<p>â€‹</p>
</li>
</ul>
<h2 id="2-çº¿ç¨‹å®‰å…¨">2 çº¿ç¨‹å®‰å…¨
</h2><h3 id="11-ç›®æ ‡-1">1.1 ç›®æ ‡
</h3><p>â€‹	ç†è§£å¤šçº¿ç¨‹æŠ€æœ¯çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p>
<h3 id="12-è·¯å¾„-1">1.2 è·¯å¾„
</h3><ol>
<li>é€šè¿‡æ¡ˆä¾‹æ¼”ç¤ºç†è§£çº¿ç¨‹å®‰å…¨çš„é‡è¦æ€§</li>
<li>ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹æ¡ˆ</li>
<li>æ­»é”</li>
</ol>
<h3 id="13-è®²è§£-1">1.3 è®²è§£
</h3><p>çº¿ç¨‹å®‰å…¨ï¼šå½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ®µç¨‹åºçš„æ—¶å€™ï¼Œå¦‚æœå¯èƒ½å‘ç”Ÿå’Œé¢„æœŸç»“æœä¸ä¸€è‡´çš„æƒ…å†µï¼Œå°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚å¦‚æœä¸€è‡´å°±æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œä¸€èˆ¬çº¿ç¨‹å®‰å…¨çš„é—®é¢˜éƒ½æ˜¯ä¼´éšç€å…±äº«å˜é‡å‘ç”Ÿçš„ï¼Œåªæœ‰ä»£ç æ»¡è¶³äº†åŸå­æ€§ï¼Œå¯è§æ€§ï¼Œæœ‰åºæ€§æ‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæœ‰ä¸€ä¸ªä¸æ»¡è¶³å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h4 id="131å–ç¥¨æ¡ˆä¾‹">1.3.1.å–ç¥¨æ¡ˆä¾‹
</h4><p>â€‹	å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚ç¨‹åºæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåä¹‹åˆ™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<pre><code class="language-java">public class Demo5Ticket {

    public static void main(String[] args) {
        //åˆ›å»ºçº¿ç¨‹ä»»åŠ¡å¯¹è±¡
        Ticket ticket = new Ticket();
        //åˆ›å»ºä¸‰ä¸ªçª—å£å¯¹è±¡
        Thread t1 = new Thread(ticket, &quot;çª—å£1&quot;);
        Thread t2 = new Thread(ticket, &quot;çª—å£2&quot;);
        Thread t3 = new Thread(ticket, &quot;çª—å£3&quot;);

        //å–ç¥¨
        t1.start();
        t2.start();
        t3.start();
    }

    static class Ticket implements Runnable {

        //Object lock = new Object();
        ReentrantLock lock = new ReentrantLock();
        private int ticket = 10;

        public void run() {
            String name = Thread.currentThread().getName();
            while (true) {
                sell(name);
                if (ticket &lt;= 0) {
                    break;
                }
            }
        }

        private void sell(String name) {
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            if (ticket &gt; 0) {
                System.out.println(name + &quot;å–ç¥¨ï¼š&quot; + ticket);
                ticket--;
            }
        }
    }
}
</code></pre>
<p>â€‹	çº¿ç¨‹å®‰å…¨é—®é¢˜éƒ½æ˜¯ç”±å…¨å±€å˜é‡åŠé™æ€å˜é‡å¼•èµ·çš„ã€‚è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™
æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œ
å¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p>
<h4 id="132çº¿ç¨‹åŒæ­¥">1.3.2.çº¿ç¨‹åŒæ­¥
</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºçš„æ—¶å€™ï¼Œä¸”å¤šä¸ªçº¿ç¨‹ä¸­å¯¹èµ„æºæœ‰å†™çš„æ“ä½œï¼Œå°±å®¹æ˜“å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚
è¦è§£å†³ä¸Šè¿°å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ä¸€ä¸ªèµ„æºçš„å®‰å…¨é—®é¢˜ï¼ŒJavaä¸­æä¾›äº†åŒæ­¥æœºåˆ¶(synchronized)æ¥è§£å†³ã€‚</p>
<p>synchronizedéƒ½æ˜¯å¯¹è±¡é”</p>
<p><strong>åŒæ­¥ä»£ç å—</strong></p>
<pre><code class="language-java">ObjectÂ lockÂ =Â newÂ Object(); //åˆ›å»ºé”
synchronized(lock){
Â Â Â Â Â //å¯èƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä»£ç 
}
</code></pre>
<p><strong>åŒæ­¥æ–¹æ³•</strong></p>
<pre><code class="language-java">//åŒæ­¥æ–¹æ³• thiså¯¹è±¡
publicÂ synchronizedÂ voidÂ method(){
Â Â Â //å¯èƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä»£ç  
}
</code></pre>
<p>åŒæ­¥æ–¹æ³•ä½¿ç”¨çš„æ˜¯thisé”</p>
<p>è¯æ˜æ–¹å¼: ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨åŒæ­¥ä»£ç å—(thisæ˜é”),å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨åŒæ­¥å‡½æ•°ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹æŠ¢ç¥¨ä¸èƒ½å®ç°åŒæ­¥ï¼Œé‚£ä¹ˆä¼šå‡ºç°æ•°æ®é”™è¯¯ã€‚</p>
<pre><code class="language-java">//ä½¿ç”¨thisé”çš„åŒæ­¥ä»£ç å—
synchronized(this){
Â Â Â Â Â //éœ€è¦åŒæ­¥æ“ä½œçš„ä»£ç 
}
</code></pre>
<p>1.synchronized(lock)ï¼Œå¯¹lockåŠ é”</p>
<p>2.åŒæ­¥æ–¹æ³•ï¼šthisé”</p>
<p>3.é™æ€åŒæ­¥æ–¹æ³•ï¼šå½“å‰ç±»çš„classå¯¹è±¡</p>
<p><strong>Locké”</strong></p>
<pre><code class="language-java">Lock lock = new ReentrantLock();
lock.lock();
	//éœ€è¦åŒæ­¥æ“ä½œçš„ä»£ç 
lock.unlock();
</code></pre>
<h4 id="133æ­»é”">1.3.3.æ­»é”
</h4><p>å¤šçº¿ç¨‹æ­»é”ï¼šåŒæ­¥ä¸­åµŒå¥—åŒæ­¥,å¯¼è‡´é”æ— æ³•é‡Šæ”¾ã€‚</p>
<p>æ­»é”è§£å†³åŠæ³•ï¼šä¸è¦åœ¨åŒæ­¥ä¸­åµŒå¥—åŒæ­¥</p>
<pre><code class="language-java">public class Demo6DeadLock {

    public static void main(String[] args) {
        //åˆ›å»ºçº¿ç¨‹ä»»åŠ¡å¯¹è±¡
        Ticket ticket = new Ticket();
        //åˆ›å»ºä¸‰ä¸ªçª—å£å¯¹è±¡
        Thread t1 = new Thread(ticket, &quot;çª—å£1&quot;);
        Thread t2 = new Thread(ticket, &quot;çª—å£2&quot;);
        Thread t3 = new Thread(ticket, &quot;çª—å£3&quot;);

        //å–ç¥¨
        t1.start();
        t2.start();
        t3.start();
    }

    static class Ticket implements Runnable {

        Object lock = new Object();
        private int ticket = 100;

        public void run() {
            String name = Thread.currentThread().getName();
            while (true) {
                if (&quot;çª—å£1&quot;.equals(name)) {
                    synchronized (lock) {
                        sell(name);
                    }
                } else {
                    sell(name);
                }
                if (ticket &lt;= 0) {
                    break;
                }
            }
        }

        private synchronized void sell(String name) {
            synchronized (lock) {
                if (ticket &gt; 0) {
                    System.out.println(name + &quot;å–ç¥¨ï¼š&quot; + ticket);
                    ticket--;
                }
            }
        }
    }
</code></pre>
<p>æ­»é”æ¡ˆä¾‹äºŒ</p>
<pre><code class="language-java">public class DeadLockDemo {
    static Object obj1 = new Object();
    static Object obj2 = new Object();

    public static void fun01(){
        System.out.println(Thread.currentThread().getId()+&quot;å°è¯•è·å–obj1çš„é”&quot;);
        synchronized (obj1){
            System.out.println(Thread.currentThread().getId()+&quot;è·å–åˆ°äº†ob1çš„é”&quot;);
            try {
                Thread.sleep(30);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            fun02();
        }
    }

    public static void fun02(){
        System.out.println(Thread.currentThread().getId()+&quot;å°è¯•è·å–obj2çš„é”&quot;);
        synchronized (obj2){
            System.out.println(Thread.currentThread().getId()+&quot;è·å–åˆ°äº†ob2çš„é”&quot;);
            try {
                Thread.sleep(30);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            fun01();
        }
    }

    public static void main(String[] args) {
        Thread thread1 = new Thread(() -&gt; fun01());
        Thread thread2 = new Thread(() -&gt; fun02());
        thread1.start();
        thread2.start();
    }
}
</code></pre>
<h3 id="14-å°ç»“-1">1.4 å°ç»“
</h3><p>çº¿ç¨‹å®‰å…¨ï¼šå½“å¤šçº¿ç¨‹æ‰§è¡ŒåŒä¸€æ®µç¨‹åºçš„æ—¶å€™ï¼Œå¦‚æœå‘ç”Ÿäº†å’Œé¢„æœŸç»“æœä¸ä¸€è‡´çš„æƒ…å†µï¼Œå°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœå’Œé¢„æœŸç»“æœä¸€è‡´å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åŠ é”è§£å†³(æŠŠå¹¶è¡Œè¿è¡Œçš„çº¿ç¨‹å˜æˆä¸²è¡ŒåŒ–æ‰§è¡Œ)ã€‚</p>
<p>åŒæ­¥é”çš„å‡ ç§æ–¹å¼(é”å¯¹è±¡):</p>
<ul>
<li>åŒæ­¥ä»£ç å—åŠ é”ï¼šsync&hellip;.(obj)</li>
<li>åŒæ­¥æ–¹æ³•åŠ é”ï¼šç­‰ä»·äºsync&hellip;.(this)</li>
<li>é™æ€åŒæ­¥æ–¹æ³•åŠ é”:ç­‰ä»·äºsync&hellip;.(this.getClass())</li>
</ul>
<p>æ­»é”ï¼šçº¿ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå°±äº§ç”Ÿäº†æ­»é”ï¼Œå°½é‡ä¸è¦åŒæ­¥ä¸­åµŒå¥—åŒæ­¥ã€‚</p>
<h2 id="3-çº¿ç¨‹çŠ¶æ€">3 çº¿ç¨‹çŠ¶æ€
</h2><h3 id="11-ç›®æ ‡-2">1.1 ç›®æ ‡
</h3><p>â€‹	æŒæ¡çº¿ç¨‹åœ¨è¿è¡ŒæœŸé—´çŠ¶æ€çš„å˜åŒ–ã€‚</p>
<h3 id="12-è·¯å¾„-2">1.2 è·¯å¾„
</h3><ol>
<li>çº¿ç¨‹çŠ¶æ€ä»‹ç»</li>
<li>wait()å’Œnotify()</li>
<li>wait()å’Œsleepçš„åŒºåˆ«</li>
<li>çº¿ç¨‹åœæ­¢</li>
</ol>
<h3 id="13-è®²è§£-2">1.3 è®²è§£
</h3><h4 id="131çº¿ç¨‹çŠ¶æ€ä»‹ç»">1.3.1.çº¿ç¨‹çŠ¶æ€ä»‹ç»
</h4><p>æŸ¥çœ‹Threadæºç ï¼Œèƒ½å¤Ÿçœ‹åˆ°javaçš„çº¿ç¨‹æœ‰å…­ç§çŠ¶æ€ï¼š</p>
<pre><code class="language-java">public enum State {
        NEW,
        RUNNABLE,
        BLOCKED,
        WAITING,
        TIMED_WAITING,
        TERMINATED;
    }
</code></pre>
<p>**NEW(æ–°å»º) **
<code>çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯å¹¶æœªå¯åŠ¨ã€‚</code>
<strong>RUNNABLE(å¯è¿è¡Œ)</strong>
<code>çº¿ç¨‹å¯ä»¥åœ¨javaè™šæ‹Ÿæœºä¸­è¿è¡Œçš„çŠ¶æ€ï¼Œå¯èƒ½æ­£åœ¨è¿è¡Œè‡ªå·±ä»£ç ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œè¿™å–å†³äºæ“ä½œç³»ç»Ÿå¤„ç†å™¨ã€‚</code>
<strong>BLOCKED(é”é˜»å¡)</strong>
<code>å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–ä¸€ä¸ªå¯¹è±¡é”ï¼Œè€Œè¯¥å¯¹è±¡é”è¢«å…¶ä»–çš„çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥BlockedçŠ¶æ€ï¼›å½“è¯¥çº¿ç¨‹æŒæœ‰é”æ—¶ï¼Œè¯¥çº¿ç¨‹å°†å˜æˆRunnableçŠ¶æ€ã€‚</code>
<strong>WAITING(æ— é™ç­‰å¾…)</strong>
<code>ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªï¼ˆå”¤é†’ï¼‰åŠ¨ä½œæ—¶ï¼Œè¯¥çº¿ç¨‹è¿›å…¥WaitingçŠ¶æ€ã€‚è¿›å…¥è¿™ä¸ªçŠ¶æ€åæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„ï¼Œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notifyæˆ–è€…notifyAllæ–¹æ³•æ‰èƒ½å¤Ÿå”¤é†’ã€‚</code>
<strong>TIMED_WAITING(è®¡æ—¶ç­‰å¾…)</strong>
<code>åŒwaitingçŠ¶æ€ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•æœ‰è¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ä»–ä»¬å°†è¿›å…¥Timed WaitingçŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€å°†ä¸€ç›´ä¿æŒåˆ°è¶…æ—¶æœŸæ»¡æˆ–è€…æ¥æ”¶åˆ°å”¤é†’é€šçŸ¥ã€‚å¸¦æœ‰è¶…æ—¶å‚æ•°çš„å¸¸ç”¨æ–¹æ³•æœ‰Thread.sleep ã€Object.waitã€‚</code>
<strong>TERMINATED(è¢«ç»ˆæ­¢)</strong>
<code>å› ä¸ºrunæ–¹æ³•æ­£å¸¸é€€å‡ºè€Œæ­»äº¡ï¼Œæˆ–è€…å› ä¸ºæ²¡æœ‰æ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†runæ–¹æ³•è€Œæ­»äº¡ã€‚</code></p>
<h5 id="çº¿ç¨‹çŠ¶æ€å›¾">çº¿ç¨‹çŠ¶æ€å›¾
</h5><p><img src="/p/juc_01/assets/1536601656694.png"
	width="733"
	height="507"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="144"
		data-flex-basis="346px"
	
></p>
<h4 id="132waitnotify">1.3.2.wait()ã€notify()
</h4><p>wait()ã€notify()ã€notifyAll()æ˜¯ä¸‰ä¸ªå®šä¹‰åœ¨Objectç±»é‡Œçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶çº¿ç¨‹çš„çŠ¶æ€ã€‚</p>
<p>wait		æ–¹æ³•ä¼šä½¿æŒæœ‰è¯¥å¯¹è±¡çš„çº¿ç¨‹æŠŠè¯¥å¯¹è±¡çš„æ§åˆ¶æƒäº¤å‡ºå»ï¼Œç„¶åå¤„äºç­‰å¾…çŠ¶æ€ã€‚
notify	æ–¹æ³•ä¼šé€šçŸ¥<strong>æŸä¸ª</strong>æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„æ§åˆ¶æƒçš„çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œèƒ½å¦ç»§ç»­è¿è¡Œå–å†³äºæ˜¯å¦è·å–åˆ°é”ã€‚
notifyAll	æ–¹æ³•ä¼šé€šçŸ¥<strong>æ‰€æœ‰</strong>æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„æ§åˆ¶æƒçš„çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œèƒ½å¦ç»§ç»­è¿è¡Œå–å†³äºæ˜¯å¦è·å–åˆ°é”ã€‚</p>
<p><strong>æ³¨æ„ï¼šä¸€å®šè¦åœ¨çº¿ç¨‹åŒæ­¥ä¸­ä½¿ç”¨,å¹¶ä¸”æ˜¯åŒä¸€ä¸ªé”çš„èµ„æº</strong></p>
<p>waitå’Œnotifyæ–¹æ³•ä¾‹å­ï¼Œæ‰“å¼€å…³é—­å¼€å…³ï¼š</p>
<pre><code class="language-java">public class DemoSwitch {

    static class Switch{
        //å¼€å…³çŠ¶æ€
        Boolean state = false;

        public Boolean getState() {
            return state;
        }

        public void setState(Boolean state) throws Exception {
            String s = state?&quot;æ‰“å¼€&quot;:&quot;å…³é—­&quot;;
            System.out.println(s);
            if(this.state==state){
                throw new Exception(&quot;å¼€å…³ä¸èƒ½è¿ç»­&quot;+s);
            }
            this.state = state;
        }
    }

    static abstract class ActionThread implements Runnable{
        //å¼€å…³
        Switch aSwitch;

        public ActionThread(Switch aSwitch) {
            this.aSwitch = aSwitch;
        }

        @Override
        public void run() {
            //å¾ªç¯
            while (true){
                //åŒæ­¥
                synchronized (aSwitch){
                    try {
                        action();
                    } catch (Exception e) {
                        e.printStackTrace();
                        break;
                    }
                }
            }
        }

        protected abstract void action() throws Exception;
    }

    public static void main(String[] args) {
        //1.åˆ›å»ºå¼€å…³
        Switch aSwitch = new Switch();
        //2.å…³é—­çº¿ç¨‹
        Thread thread1 = new Thread(new ActionThread(aSwitch){
            @Override
            protected void action() throws Exception {
                //RUNNABLE
                System.out.println(&quot;thread1è·å–åˆ°aSwitchå¯¹è±¡çš„é”å:&quot;+Thread.currentThread().getState().name());
                //å¦‚æœå¼€å…³æ˜¯å…³é—­çš„
                if(!this.aSwitch.getState()){
                    try {
                        //è®©å½“å‰çº¿ç¨‹é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…
                        this.aSwitch.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                //å…³é—­å¼€å…³
                this.aSwitch.setState(false);
                //å”¤é†’ç­‰å¾…ä¸­çš„ä¸€ä¸ªçº¿ç¨‹
                this.aSwitch.notify();
            }
        });
        //new
        System.out.println(&quot;åˆ›å»ºthread1æœªè¿è¡Œæ—¶çš„çŠ¶æ€æ˜¯:&quot;+thread1.getState().name());
        //2.æ‰“å¼€çº¿ç¨‹
        Thread thread2 = new Thread(new ActionThread(aSwitch){
            @Override
            protected void action() throws Exception {
                //BLOCKED
                System.out.println(&quot;thread2è·å–åˆ°aSwitchå¯¹è±¡çš„é”å:&quot;+thread1.getState().name());
                //å¦‚æœå¼€å…³æ˜¯æ‰“å¼€çš„
                if(this.aSwitch.getState()){
                    try {
                        //è®©å½“å‰çº¿ç¨‹é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…
                        this.aSwitch.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                //æ‰“å¼€å¼€å…³
                this.aSwitch.setState(true);
                //wait
                System.out.println(&quot;thread2çº¿ç¨‹åœ¨è°ƒç”¨notifyä¹‹å‰:&quot;+thread1.getState().name());
                //å”¤é†’ç­‰å¾…ä¸­çš„ä¸€ä¸ªçº¿ç¨‹
                this.aSwitch.notify();

            }
        });

        thread1.start();
        thread2.start();
    }
}
</code></pre>
<h4 id="133waitä¸sleepåŒºåˆ«">1.3.3.waitä¸sleepåŒºåˆ«
</h4><ul>
<li>
<p>å¯¹äºsleep()æ–¹æ³•ï¼Œé¦–å…ˆè¦çŸ¥é“è¯¥æ–¹æ³•æ˜¯å±äºThreadç±»ä¸­çš„ã€‚è€Œwait()æ–¹æ³•ï¼Œåˆ™æ˜¯å±äºObjectç±»ä¸­çš„ã€‚</p>
</li>
<li>
<p>sleep()æ–¹æ³•å¯¼è‡´äº†ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡ºcpuè°ƒåº¦å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿æŒè€…ï¼Œå½“æŒ‡å®šçš„æ—¶é—´åˆ°äº†åˆä¼šè‡ªåŠ¨æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>wait()æ˜¯æŠŠæ§åˆ¶æƒäº¤å‡ºå»ï¼Œç„¶åè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåªæœ‰é’ˆå¯¹æ­¤å¯¹è±¡è°ƒç”¨notify()æ–¹æ³•åæœ¬çº¿ç¨‹æ‰è¿›å…¥å¯¹è±¡é”å®šæ± å‡†å¤‡è·å–å¯¹è±¡é”è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</p>
</li>
<li>
<p>åœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚è€Œå½“è°ƒç”¨wait()æ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ã€‚</p>
</li>
</ul>
<h4 id="134çº¿ç¨‹åœæ­¢">1.3.4.çº¿ç¨‹åœæ­¢
</h4><p>ç»“æŸçº¿ç¨‹æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š
ï¼ˆ1ï¼‰è‡ªå®šä¹‰é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºã€‚
ï¼ˆ2ï¼‰ä½¿ç”¨interrupt()æ–¹æ³•ä¸­æ–­çº¿ç¨‹ï¼Œä½¿ç”¨çº¿ç¨‹å†…éƒ¨çš„é€€å‡ºæ ‡å¿—ã€‚
ï¼ˆ3ï¼‰<del>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢çº¿ç¨‹</del>ï¼ˆä¸æ¨èä½¿ç”¨Thread.stop, è¿™ç§ç»ˆæ­¢çº¿ç¨‹è¿è¡Œçš„æ–¹æ³•å·²ç»è¢«åºŸå¼ƒï¼Œä½¿ç”¨å®ƒä»¬æ˜¯æç«¯ä¸å®‰å…¨çš„ï¼ï¼‰</p>
<h5 id="151-è‡ªå®šä¹‰é€€å‡ºæ ‡å¿—">1.5.1 è‡ªå®šä¹‰é€€å‡ºæ ‡å¿—Â 
</h5><p>Â  Â  Â  Â ä¸€èˆ¬run()æ–¹æ³•æ‰§è¡Œå®Œï¼Œçº¿ç¨‹å°±ä¼šæ­£å¸¸ç»“æŸï¼Œç„¶è€Œï¼Œå¸¸å¸¸æœ‰äº›çº¿ç¨‹æ˜¯ä¼ºæœçº¿ç¨‹ã€‚å®ƒä»¬éœ€è¦é•¿æ—¶é—´çš„è¿è¡Œï¼Œåªæœ‰åœ¨å¤–éƒ¨æŸäº›æ¡ä»¶æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½å…³é—­è¿™äº›çº¿ç¨‹ã€‚ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶å¾ªç¯ï¼Œä¾‹å¦‚ï¼šæœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯è®¾ä¸€ä¸ªbooleanç±»å‹çš„æ ‡å¿—ï¼Œå¹¶é€šè¿‡è®¾ç½®è¿™ä¸ªæ ‡å¿—ä¸ºtrueæˆ–falseæ¥æ§åˆ¶whileå¾ªç¯æ˜¯å¦é€€å‡ºï¼Œä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-java">public class Demo8Exit {

    public static boolean exit = true;

    public static void main(String[] args) throws InterruptedException {
        Thread t = new Thread(new Runnable() {
            public void run() {
                while (exit) {
                    try {
                        System.out.println(&quot;çº¿ç¨‹æ‰§è¡Œï¼&quot;);
                        Thread.sleep(100l);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }
        });
        t.start();

        Thread.sleep(1000l);
        exit = false;
        System.out.println(&quot;é€€å‡ºæ ‡è¯†ä½è®¾ç½®æˆåŠŸ&quot;);
    }
}
</code></pre>
<h5 id="152-ä½¿ç”¨interruptæ–¹æ³•">1.5.2 ä½¿ç”¨interrupt()æ–¹æ³•
</h5><p>ä½¿ç”¨interrupt()æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<p><strong>1)çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€</strong></p>
<p>â€‹	å¦‚ä½¿ç”¨äº†sleep,åŒæ­¥é”çš„wait,socketä¸­çš„receiver,acceptç­‰æ–¹æ³•æ—¶ï¼Œä¼šä½¿çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ã€‚å½“è°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•æ—¶ï¼Œä¼šæŠ›å‡ºInterruptExceptionå¼‚å¸¸ã€‚é˜»å¡ä¸­çš„é‚£ä¸ªæ–¹æ³•æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œé€šè¿‡ä»£ç æ•è·è¯¥å¼‚å¸¸ï¼Œç„¶åbreakè·³å‡ºå¾ªç¯çŠ¶æ€ï¼Œä»è€Œè®©æˆ‘ä»¬æœ‰æœºä¼šç»“æŸè¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œã€‚</p>
<p><strong>2)çº¿ç¨‹æœªå¤„äºé˜»å¡çŠ¶æ€</strong></p>
<p>â€‹	ä½¿ç”¨isInterrupted()åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—æ¥é€€å‡ºå¾ªç¯ã€‚å½“ä½¿ç”¨interrupt()æ–¹æ³•æ—¶ï¼Œä¸­æ–­æ ‡å¿—å°±ä¼šç½®trueï¼Œå’Œä½¿ç”¨è‡ªå®šä¹‰çš„æ ‡å¿—æ¥æ§åˆ¶å¾ªç¯æ˜¯ä¸€æ ·çš„é“ç†ã€‚</p>
<pre><code class="language-java">public class Demo9Interrupt {

    public static boolean exit = true;

    public static void main(String[] args) throws InterruptedException {
        Thread t = new Thread(new Runnable() {
            public void run() {
                while (exit) {
                    try {
                        System.out.println(&quot;çº¿ç¨‹æ‰§è¡Œï¼&quot;);

                        //åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—æ¥é€€å‡ºå¾ªç¯
                        if (Thread.currentThread().isInterrupted()) {
                            break;
                        }

                        Thread.sleep(100l);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                        //çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€,å½“è°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•æ—¶ï¼Œ
                        //ä¼šæŠ›å‡ºInterruptExceptionå¼‚å¸¸,è·³å‡ºå¾ªç¯
                        break;
                    }
                }
            }
        });
        t.start();

        Thread.sleep(1000l);
        //ä¸­æ–­çº¿ç¨‹
        t.interrupt();
        System.out.println(&quot;çº¿ç¨‹ä¸­æ–­äº†&quot;);
    }
}
</code></pre>
<h3 id="14-å°ç»“-2">1.4 å°ç»“
</h3><p>çº¿ç¨‹çŠ¶æ€ï¼š</p>
<ul>
<li>NEWï¼šçº¿ç¨‹è¢«åˆ›å»ºä½†æ˜¯æ²¡æœ‰startè¿è¡Œ</li>
<li>RUNABLE:çº¿ç¨‹å¯ä»¥è¿è¡Œï¼Œæ˜¯å¦è¿è¡Œå–å†³äºcpuæ˜¯å¦è°ƒåº¦è¯¥çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰è°ƒåº¦å°±æ˜¯readyï¼Œå¦‚è°ƒåº¦åˆ°å°±æ˜¯running</li>
<li>WAITINGï¼šå½“é”å¯¹è±¡è°ƒç”¨waitæ–¹æ³•ï¼Œä¼šè®©æŒæœ‰è¯¥é”å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥æ— é™ç­‰å¾…çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€åªæœ‰è¢«åŒä¸€ä¸ªé”å¯¹è±¡çš„notifyæ‰èƒ½è§£é™¤ï¼Œè§£é™¤åè¿›å…¥RUNABLEçŠ¶æ€ã€‚</li>
<li>TIMED_WAITINGï¼šsleep(time),wait(time)çš„æ—¶å€™è¿›å…¥è®¡æ—¶ç­‰å¾…ï¼Œå½“æ—¶é—´åˆ°äº†ï¼Œç»§ç»­è¿è¡Œ</li>
<li>BLOCKEDï¼šåœ¨çº¿ç¨‹è·å–ä¸åˆ°é”å¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå½“å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”ï¼Œæœ¬çº¿ç¨‹è·å–åˆ°é”æ‰èƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚</li>
<li>TERMINATEDï¼šrunæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚</li>
</ul>
<p>waitå’Œsleepçš„åŒºåˆ«ï¼š</p>
<ul>
<li>waitæ˜¯å±äºobjectå¯¹è±¡çš„æ–¹æ³•ï¼Œsleepæ˜¯å±äºThreadç±»çš„æ–¹æ³•</li>
<li>waitä¼šè®©å½“å‰æŒæœ‰è¯¥å¯¹è±¡é”çš„çº¿ç¨‹åœæ­¢è¿è¡Œï¼Œè¿›å…¥waitingçŠ¶æ€ï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾é”ï¼Œåªæœ‰åŒä¸€ä¸ªå¯¹è±¡çš„notify/notifyAllæ–¹æ³•æ‰èƒ½å¤Ÿå”¤é†’,sleepä¸ä¼šé‡Šæ”¾é”ï¼Œè®©çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´ç»§ç»­è¿è¡Œã€‚</li>
</ul>
<p>çº¿ç¨‹ç»ˆæ­¢ï¼š</p>
<ul>
<li>
<p>è‡ªå®šä¹‰é€€å‡ºæ ‡è¯†ï¼šç¼ºç‚¹æ˜¯çº¿ç¨‹åœ¨sleepçš„æ—¶å€™æ˜¯æ— æ³•ç«‹åˆ»é€€å‡ºï¼Œå¿…é¡»ç­‰çº¿ç¨‹æ‰§è¡Œåˆ°äº†åˆ¤æ–­æ ‡è¯†çš„åœ°æ–¹æ‰èƒ½å¤Ÿåœæ­¢</p>
</li>
<li>
<p>ä½¿ç”¨çº¿ç¨‹è‡ªå·±çš„é€€å‡ºæ ‡è¯†ï¼š</p>
<ul>
<li>
<p>å¦‚æœçº¿ç¨‹æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥é€šè¿‡Thread.currentThread().isInterrupted()åˆ¤æ–­é€€å‡º</p>
</li>
<li>
<p>å¦‚æœå½“å‰çº¿ç¨‹æ­£åœ¨sleepï¼Œé€šè¿‡â€˜t.interrupt();â€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡æ•è·å¼‚å¸¸ç«‹åˆ»çº¿ç¨‹çš„è¿è¡Œã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 id="4-çº¿ç¨‹ä¼˜å…ˆçº§">4 çº¿ç¨‹ä¼˜å…ˆçº§
</h2><h3 id="11-ç›®æ ‡-3">1.1 ç›®æ ‡
</h3><p>â€‹	ç†è§£å¤šçº¿ç¨‹æŠ€æœ¯çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p>
<h3 id="12-è·¯å¾„-3">1.2 è·¯å¾„
</h3><ol>
<li>è®¾ç½®å¹¶ç†è§£çº¿ç¨‹çš„ä¼˜å…ˆçº§priority</li>
<li>ç†è§£å¹¶æŒæ¡join()æ–¹æ³•çš„ä½¿ç”¨</li>
<li>ç†è§£yield()æ–¹æ³•çš„æ¦‚å¿µ</li>
</ol>
<h3 id="13-è®²è§£-3">1.3 è®²è§£
</h3><h5 id="1ä¼˜å…ˆçº§priority">1.ä¼˜å…ˆçº§priority
</h5><p>â€‹	ç°ä»Šæ“ä½œç³»ç»ŸåŸºæœ¬é‡‡ç”¨åˆ†æ—¶çš„å½¢å¼è°ƒåº¦è¿è¡Œçš„çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ†é…å¾—åˆ°æ—¶é—´ç‰‡çš„å¤šå°‘å†³å®šäº†çº¿ç¨‹ä½¿ç”¨å¤„ç†å™¨èµ„æºçš„å¤šå°‘ï¼Œä¹Ÿå¯¹åº”äº†çº¿ç¨‹ä¼˜å…ˆçº§è¿™ä¸ªæ¦‚å¿µã€‚</p>
<p>â€‹	åœ¨JAVAçº¿ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªint priorityæ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼ŒèŒƒå›´ä¸º1-10ï¼Œå…¶ä¸­10æœ€é«˜ï¼Œé»˜è®¤å€¼ä¸º5ã€‚</p>
<pre><code class="language-java">public class Demo10Priorityt {

    public static void main(String[] args) {
        PrioritytThread prioritytThread = new PrioritytThread();

        // å¦‚æœ8æ ¸CPUå¤„ç†3çº¿ç¨‹ï¼Œæ— è®ºä¼˜å…ˆçº§é«˜ä½ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯å•ç‹¬ä¸€ä¸ªCPUæ‰§è¡Œï¼Œå°±æ— æ³•ä½“ç°ä¼˜å…ˆçº§
        // å¼€å¯10ä¸ªçº¿ç¨‹ï¼Œè®©8ä¸ªCPUå¤„ç†ï¼Œè¿™é‡Œçº¿ç¨‹å°±éœ€è¦ç«äº‰CPUèµ„æºï¼Œä¼˜å…ˆçº§é«˜çš„èƒ½åˆ†é…æ›´å¤šçš„CPUèµ„æº
        for (int i = 0; i &lt; 10; i++) {
            Thread t = new Thread(prioritytThread, &quot;çº¿ç¨‹&quot; + i);
            if (i == 1) {
                t.setPriority(10);
            }
            if (i == 2) {
                t.setPriority(1);
            }
            t.setDaemon(true);
            t.start();
        }

        try {
            Thread.sleep(1000l);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        System.out.println(&quot;çº¿ç¨‹1æ€»è®¡ï¼š&quot; + PrioritytThread.count1);
        System.out.println(&quot;çº¿ç¨‹2æ€»è®¡ï¼š&quot; + PrioritytThread.count2);
    }

    static class PrioritytThread implements Runnable {
        public static Integer count1 = 0;
        public static Integer count2 = 0;

        public void run() {
            while (true) {
                if (&quot;çº¿ç¨‹1&quot;.equals(Thread.currentThread().getName())) {
                    count1++;
                }
                if (&quot;çº¿ç¨‹2&quot;.equals(Thread.currentThread().getName())) {
                    count2++;
                }

                if (Thread.currentThread().isInterrupted()) {
                    break;
                }
            }
        }
    }
}
</code></pre>
<h5 id="2joinæ–¹æ³•">2.join()æ–¹æ³•
</h5><p>joinä½œç”¨æ˜¯è®©å…¶ä»–çº¿ç¨‹å˜ä¸ºç­‰å¾…ã€‚thread.JoinæŠŠæŒ‡å®šçš„çº¿ç¨‹åŠ å…¥åˆ°å½“å‰çº¿ç¨‹ï¼Œå¯ä»¥å°†ä¸¤ä¸ªäº¤æ›¿æ‰§è¡Œçš„çº¿ç¨‹åˆå¹¶ä¸ºé¡ºåºæ‰§è¡Œçš„çº¿ç¨‹ã€‚æ¯”å¦‚åœ¨çº¿ç¨‹Bä¸­è°ƒç”¨äº†çº¿ç¨‹Açš„Join()æ–¹æ³•ï¼Œç›´åˆ°çº¿ç¨‹Aæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œçº¿ç¨‹Bã€‚</p>
<pre><code class="language-java">public class Demo11Join {
    public static void main(String[] args) {
        Thread thread1 = new Thread(new Runnable() {
            @Override
            public void run() {
                for (int i = 0; i &lt; 10; i++) {
                    String name = Thread.currentThread().getName();
                    System.out.println(name+&quot;æ‰§è¡Œ&quot;+i);
                }
            }
        }, &quot;çº¿ç¨‹1&quot;);
        Thread thread2 = new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    thread1.join();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                for (int i = 0; i &lt; 10; i++) {
                    String name = Thread.currentThread().getName();
                    System.out.println(name+&quot;æ‰§è¡Œ&quot;+i);
                }
            }
        }, &quot;çº¿ç¨‹2&quot;);
        Thread thread3 = new Thread(new Runnable() {
            @Override
            public void run() {
                try {
                    thread2.join();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                for (int i = 0; i &lt; 10; i++) {
                    String name = Thread.currentThread().getName();
                    System.out.println(name+&quot;æ‰§è¡Œ&quot;+i);
                }
            }
        }, &quot;çº¿ç¨‹3&quot;);
        thread1.start();
        thread2.start();
        thread3.start();

       /* try {
            thread3.join();
        } catch (Exception e) {

        }*/
        for (int i = 0; i &lt; 5; i++) {
            System.out.println(&quot;main ---i:&quot; + i);
        }
    }

}
</code></pre>
<h5 id="3yieldæ–¹æ³•running-ready">3.yieldæ–¹æ³•ï¼ˆrunning-&gt;readyï¼‰
</h5><p>Thread.yield()æ–¹æ³•çš„ä½œç”¨ï¼šæš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚ï¼ˆå¯èƒ½æ²¡æœ‰æ•ˆæœï¼‰
yield()è®©å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å›åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä»¥å…è®¸å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶ä»–çº¿ç¨‹è·å¾—è¿è¡Œçš„æœºä¼šã€‚å› æ­¤ï¼Œä½¿ç”¨yield()çš„ç›®çš„æ˜¯è®©å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹é—´èƒ½å¤Ÿé€‚å½“çš„è½®æ¢æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå®é™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥çš„ç›®çš„ï¼Œå› ä¸ºï¼Œè®©æ­¥çš„çº¿ç¨‹å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚</p>
<p>æŸ¥çœ‹æºç ä»‹ç»ï¼š</p>
<p><img src="/p/juc_01/assets/1558669569583.png"
	width="760"
	height="413"
	
	loading="lazy"
	
		alt="1558669569583"
	
	
		class="gallery-image" 
		data-flex-grow="184"
		data-flex-basis="441px"
	
></p>
<p>ç»“è®ºï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œyield()å°†å¯¼è‡´çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä½†æœ‰å¯èƒ½æ²¡æœ‰æ•ˆæœã€‚</p>
<h3 id="14-å°ç»“-3">1.4 å°ç»“
</h3><p>ä¼˜å…ˆçº§ï¼šä»1-10ï¼Œé»˜è®¤å€¼æ˜¯5ï¼Œè¡¨ç¤ºçº¿ç¨‹è¢«cpuè°ƒåº¦çš„æ¦‚ç‡ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜å°±è¶Šæœ‰å¯èƒ½è¢«cpuè°ƒåº¦åˆ°å»æ‰§è¡Œï¼Œä»å®è§‚è§’åº¦æ¥è¯´ï¼Œä¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹åœ¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå®ƒä»¬çš„ä¼˜å…ˆçº§è¡¨ç¤ºçš„å°±æ˜¯çº¿ç¨‹å ç”¨cpuæ—¶é—´ç‰‡çš„å¤šå°‘ã€‚</p>
<p>joinæ–¹æ³•ï¼šçº¿ç¨‹aé‡Œé¢è°ƒç”¨çº¿ç¨‹b.joinæ–¹æ³•ï¼Œå°±æ˜¯è®©çº¿ç¨‹bå…ˆæ‰§è¡Œï¼Œbæ‰§è¡Œå®Œäº†åœ¨æ‰§è¡Œçº¿ç¨‹a</p>
<p>yieldæ–¹æ³•ï¼šå°±æ˜¯è®©å½“å‰çº¿ç¨‹è®©å‡ºcpuèµ„æºï¼ˆrunning-&gt;readyåˆ‡æ¢ï¼‰,å¯èƒ½æ²¡æœ‰æ•ˆæœï¼Œå› ä¸ºcpuæœ‰å¯èƒ½å†åº¦è°ƒåº¦åˆ°è¯¥çº¿ç¨‹æ‰§è¡Œ</p>
<h2 id="5-å¤šçº¿ç¨‹å¹¶å‘çš„3ä¸ªç‰¹æ€§">5. å¤šçº¿ç¨‹å¹¶å‘çš„3ä¸ªç‰¹æ€§
</h2><h3 id="11-ç›®æ ‡-4">1.1 ç›®æ ‡
</h3><p>â€‹	ç†è§£å¤šçº¿ç¨‹å¹¶å‘çš„3ä¸ªç‰¹æ€§ã€‚</p>
<h3 id="12-è·¯å¾„-4">1.2 è·¯å¾„
</h3><ol>
<li>åŸå­æ€§</li>
<li>å¯è§æ€§</li>
<li>æœ‰åºæ€§</li>
</ol>
<h3 id="13-è®²è§£-4">1.3 è®²è§£
</h3><p>â€‹	å¤šçº¿ç¨‹å¹¶å‘å¼€å‘ä¸­ï¼Œè¦çŸ¥é“ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹çš„åŸå­æ€§ï¼Œå¯è§æ€§å’Œæœ‰åºæ€§ï¼Œä»¥é¿å…ç›¸å…³çš„é—®é¢˜äº§ç”Ÿã€‚</p>
<h4 id="131-åŸå­æ€§ä¸å¯åˆ†å‰²çš„æœ€å°å•ä½">1.3.1 åŸå­æ€§ï¼ˆä¸å¯åˆ†å‰²çš„æœ€å°å•ä½ï¼‰
</h4><p>åŸå­æ€§ï¼š<code>å³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œ è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œ</code></p>
<p>ä¸€ä¸ªå¾ˆç»å…¸çš„ä¾‹å­å°±æ˜¯é“¶è¡Œè´¦æˆ·è½¬è´¦é—®é¢˜ï¼š</p>
<p>æ¯”å¦‚ä»è´¦æˆ·Aå‘è´¦æˆ·Bè½¬1000å…ƒï¼Œé‚£ä¹ˆå¿…ç„¶åŒ…æ‹¬2ä¸ªæ“ä½œï¼šä»è´¦æˆ·Aå‡å»1000å…ƒï¼Œå¾€è´¦æˆ·BåŠ ä¸Š1000å…ƒã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¿™2ä¸ªæ“ä½œä¸å…·å¤‡åŸå­æ€§ï¼Œä¼šé€ æˆä»€ä¹ˆæ ·çš„åæœã€‚å‡å¦‚ä»è´¦æˆ·Aå‡å»1000å…ƒä¹‹åï¼Œæ“ä½œçªç„¶ä¸­æ­¢ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´è´¦æˆ·Aè™½ç„¶å‡å»äº†1000å…ƒï¼Œä½†æ˜¯è´¦æˆ·Bæ²¡æœ‰æ”¶åˆ°è¿™ä¸ªè½¬è¿‡æ¥çš„1000å…ƒã€‚</p>
<p>æ‰€ä»¥è¿™2ä¸ªæ“ä½œ<strong>å¿…é¡»è¦å…·å¤‡åŸå­æ€§</strong>æ‰èƒ½ä¿è¯ä¸å‡ºç°ä¸€äº›æ„å¤–çš„é—®é¢˜ã€‚</p>
<p><strong>å›é¡¾ä¹‹å‰çš„ä¹°ç¥¨æ¡ˆä¾‹</strong>ã€‚</p>
<h4 id="132-å¯è§æ€§">1.3.2 å¯è§æ€§
</h4><p>å¯è§æ€§ï¼š<code>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼</code></p>
<p>å‰é¢è®²è¿‡å¤šçº¿ç¨‹çš„å†…å­˜å¯è§æ€§ï¼Œç°åœ¨æˆ‘ä»¬å†™ä¸€ä¸ªå†…å­˜ä¸å¯è§çš„é—®é¢˜ã€‚</p>
<p>æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class DemoVisible {

    public static void main(String[] args) throws InterruptedException {

        JmmDemo demo = new JmmDemo();
        Thread t = new Thread(demo);
        t.start();
        Thread.sleep(100);
        demo.flag = false;
        System.out.println(&quot;å·²ç»ä¿®æ”¹ä¸ºfalse&quot;);
        System.out.println(demo.flag);
    }

    static class JmmDemo implements Runnable {
        public boolean flag = true;

        public void run() {
            System.out.println(&quot;å­çº¿ç¨‹æ‰§è¡Œã€‚ã€‚ã€‚&quot;);
            while (flag) {
            }
            System.out.println(&quot;å­çº¿ç¨‹ç»“æŸã€‚ã€‚ã€‚&quot;);
        }
    }
}
</code></pre>
<p>æ‰§è¡Œç»“æœ</p>
<p><img src="/p/juc_01/assets/1558602652109.png"
	width="240"
	height="140"
	
	loading="lazy"
	
		alt="1558602652109"
	
	
		class="gallery-image" 
		data-flex-grow="171"
		data-flex-basis="411px"
	
></p>
<p>â€‹	æŒ‰ç…§mainæ–¹æ³•çš„é€»è¾‘ï¼Œæˆ‘ä»¬å·²ç»æŠŠflagè®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆä»é€»è¾‘ä¸Šè®²ï¼Œå­çº¿ç¨‹å°±åº”è¯¥è·³å‡ºwhileæ­»å¾ªç¯ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æ¡ä»¶ä¸æˆç«‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºä»æ—§æ‰§è¡Œä¸­ï¼Œå¹¶æ²¡æœ‰åœæ­¢ã€‚</p>
<p>â€‹	åŸå› :</p>
<p>â€‹		1.å’Œ<strong>javaå†…å­˜æ¨¡å‹</strong>æœ‰å…³ï¼Œå¤šçº¿ç¨‹è®¿é—®å…±äº«å˜é‡æ—¶ä¼šåˆ›å»ºå‰¯æœ¬å˜é‡ï¼Œä¿®æ”¹åå†å†™å›ä¸»å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹å‰¯æœ¬å˜é‡çš„å€¼æ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œå¯¼è‡´å¯è§æ€§çš„é—®é¢˜ã€‚</p>
<pre><code class="language-java">//çº¿ç¨‹1æ‰§è¡Œçš„ä»£ç 
int i = 0;
i = 10;

//çº¿ç¨‹2æ‰§è¡Œçš„ä»£ç 
j = i;
</code></pre>
<p>å½“çº¿ç¨‹1æ‰§è¡Œ<code>int i = 0</code>è¿™å¥æ—¶ï¼Œ<code>i</code>çš„åˆå§‹å€¼0åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†æ‰§è¡Œ<code>i = 10</code>ï¼Œé‚£ä¹ˆåœ¨å†…å­˜ä¸­<code>i</code>çš„å€¼å˜ä¸º10äº†ã€‚</p>
<p>å¦‚æœå½“çº¿ç¨‹1æ‰§è¡Œåˆ°<code>int i = 0</code>è¿™å¥æ—¶ï¼Œæ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œ j = iï¼Œå®ƒè¯»å–<code>i</code>çš„å€¼å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ³¨æ„æ­¤æ—¶å†…å­˜å½“ä¸­içš„å€¼æ˜¯0ï¼Œé‚£ä¹ˆå°±ä¼šä½¿å¾—<code>j</code>çš„å€¼ä¹Ÿä¸º0ï¼Œè€Œä¸æ˜¯10ã€‚</p>
<p>è¿™å°±æ˜¯å¯è§æ€§é—®é¢˜ï¼Œçº¿ç¨‹1å¯¹å˜é‡<code>i</code>ä¿®æ”¹äº†ä¹‹åï¼Œçº¿ç¨‹2æ²¡æœ‰ç«‹å³çœ‹åˆ°çº¿ç¨‹1ä¿®æ”¹çš„å€¼ã€‚</p>
<p>â€‹	<strong>è§£å†³æ–¹æ¡ˆï¼šä¸€èˆ¬ä½¿ç”¨volatileæˆ–åŒæ­¥é”ä¿è¯å…¶å†…å­˜çš„å¯è§æ€§</strong></p>
<h4 id="133-æœ‰åºæ€§">1.3.3 æœ‰åºæ€§
</h4><p>æœ‰åºæ€§ï¼š<code>ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</code></p>
<pre><code class="language-java">boolean flag = false;
int count = 0;
count = 1; //è¯­å¥1
flag = true; //è¯­å¥2
</code></pre>
<p>â€‹	ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸€ä¸ªintå‹å˜é‡ï¼Œå®šä¹‰äº†ä¸€ä¸ªbooleanç±»å‹å˜é‡ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œã€‚ä»ä»£ç é¡ºåºä¸Šçœ‹ï¼Œè¯­å¥1æ˜¯åœ¨è¯­å¥2å‰é¢çš„ï¼Œé‚£ä¹ˆJVMåœ¨çœŸæ­£æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ä¼šä¿è¯è¯­å¥1ä¸€å®šä¼šåœ¨è¯­å¥2å‰é¢æ‰§è¡Œå—ï¼Ÿä¸ä¸€å®šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œå¯èƒ½ä¼šå‘ç”Ÿ<strong>æŒ‡ä»¤é‡æ’åº</strong>ï¼ˆInstruction Reorderï¼‰ã€‚</p>
<p>â€‹	ä»€ä¹ˆæ˜¯é‡æ’åºï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå¤„ç†å™¨ä¸ºäº†<strong>æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡</strong>ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ã€‚</p>
<p>â€‹	as-if-serial:æ— è®ºå¦‚ä½•é‡æ’åºï¼Œç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚Javaç¼–è¯‘å™¨ã€è¿è¡Œæ—¶å’Œå¤„ç†å™¨éƒ½ä¼šä¿è¯Javaåœ¨<strong>å•çº¿ç¨‹</strong>ä¸‹éµå¾ªas-if-serialè¯­æ„ï¼‰</p>
<p>â€‹	 ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè¯­å¥1å’Œè¯­å¥2è°å…ˆæ‰§è¡Œå¯¹æœ€ç»ˆçš„ç¨‹åºç»“æœå¹¶æ²¡æœ‰å½±å“ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯­å¥2å…ˆæ‰§è¡Œè€Œè¯­å¥1åæ‰§è¡Œã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè™½ç„¶å¤„ç†å™¨ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆç»“æœä¼šå’Œä»£ç é¡ºåºæ‰§è¡Œç»“æœç›¸åŒï¼Œé‚£ä¹ˆå®ƒé ä»€ä¹ˆä¿è¯çš„å‘¢ï¼Ÿ</p>
<p>å†çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-java">int a = 10; //è¯­å¥1
int b = 2; //è¯­å¥2
a = a + 3; //è¯­å¥3
b = a*a; //è¯­å¥4
</code></pre>
<p>è¿™æ®µä»£ç æœ‰4ä¸ªè¯­å¥ï¼Œé‚£ä¹ˆå¯èƒ½çš„ä¸€ä¸ªæ‰§è¡Œé¡ºåºæ˜¯ï¼š  è¯­å¥2   è¯­å¥1    è¯­å¥3   è¯­å¥4</p>
<p>ä¸å¯èƒ½æ˜¯è¿™ä¸ªæ‰§è¡Œé¡ºåºï¼š è¯­å¥2   è¯­å¥1    è¯­å¥4   è¯­å¥3</p>
<p>å› ä¸ºå¤„ç†å™¨åœ¨è¿›è¡Œé‡æ’åºæ—¶æ˜¯ä¼šè€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ï¼Œå¦‚æœä¸€ä¸ªæŒ‡ä»¤Instruction 2å¿…é¡»ç”¨åˆ°Instruction 1çš„ç»“æœï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šä¿è¯Instruction 1ä¼šåœ¨Instruction 2ä¹‹å‰æ‰§è¡Œã€‚==è™½ç„¶é‡æ’åºä¸ä¼šå½±å“å•ä¸ªçº¿ç¨‹å†…ç¨‹åºæ‰§è¡Œçš„ç»“æœï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¼šæœ‰å½±å“==</p>
<p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-java">//çº¿ç¨‹1:
init = false
context = loadContext(); //è¯­å¥1
init = true; //è¯­å¥2

//çº¿ç¨‹2:
while(!init){//å¦‚æœåˆå§‹åŒ–æœªå®Œæˆï¼Œç­‰å¾…
  sleep();
}
execute(context);//åˆå§‹åŒ–å®Œæˆï¼Œæ‰§è¡Œé€»è¾‘
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ==ç”±äºè¯­å¥1å’Œè¯­å¥2æ²¡æœ‰æ•°æ®ä¾èµ–æ€§ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«é‡æ’åº==ã€‚å‡å¦‚å‘ç”Ÿäº†é‡æ’åºï¼Œåœ¨çº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆæ‰§è¡Œè¯­å¥2ï¼Œè€Œæ­¤æ˜¯çº¿ç¨‹2ä¼šä»¥ä¸ºåˆå§‹åŒ–å·¥ä½œå·²ç»å®Œæˆï¼Œé‚£ä¹ˆå°±ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œå»æ‰§è¡Œexecute(context)æ–¹æ³•ï¼Œè€Œæ­¤æ—¶contextå¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<strong>é‡æ’åºä¸ä¼šå½±å“å•ä¸ªçº¿ç¨‹çš„æ‰§è¡Œï¼Œä½†æ˜¯ä¼šå½±å“åˆ°çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§</strong>ã€‚</p>
<h3 id="14-å°ç»“-4">1.4 å°ç»“
</h3><p>â€‹		è¦æƒ³å¹¶å‘ç¨‹åºæ­£ç¡®åœ°æ‰§è¡Œï¼Œå¿…é¡»è¦ä¿è¯åŸå­æ€§ã€å¯è§æ€§ä»¥åŠæœ‰åºæ€§ã€‚åªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰è¢«ä¿è¯ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œä¸æ­£ç¡®ã€‚</p>
<p>â€‹		åŸå­æ€§ï¼šä¸å¯åˆ†å‰²ï¼Œè¯´æ˜è¿™ä¸€æ®µç¨‹åºè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆä¸æ‰§è¡Œï¼Œå¹¶ä¸”ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å½±å“ï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥æ–¹æ³•,åŒæ­¥å—ï¼Œé”è§£å†³ã€‚</p>
<p>â€‹		å¯è§æ€§ï¼šå¤šçº¿ç¨‹å¯¹äºå…±äº«å˜é‡çš„è®¿é—®ï¼Œå¿…é¡»æ¯æ¬¡éƒ½è·å–åˆ°ä¸»å˜é‡çš„å€¼ã€‚å¯ä»¥ä½¿ç”¨volatileæˆ–è€…åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥å—ï¼Œé”è§£å†³ã€‚</p>
<p>â€‹		åŸå› 1ï¼šå’Œå†…å­˜æ¨¡å‹æœ‰å…³ï¼Œæ¯æ¬¡å»è¯»å–å†…å­˜ä¸­çš„å€¼ä¼šåŠ è½½åˆ°cpuç¼“å­˜ã€‚</p>
<p>â€‹		åŸå› 2ï¼šjvmæœ‰æ—¶å€™ä¼šè®¤ä¸ºç¨‹åºæ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œæˆ–è€…æ‰§è¡Œçš„é€»è¾‘å¯¹å˜é‡æ²¡æœ‰å½±å“ï¼Œå°±ä¼šé‡å¤è¯»å–cpuç¼“å­˜çš„å˜é‡ï¼Œå¯¼è‡´å¯è§æ€§çš„é—®é¢˜ã€‚</p>
<p>â€‹		æœ‰åºæ€§:ç”±jvmæŒ‡ä»¤é‡æ’å¯¼è‡´çš„ï¼ŒæŒ‡ä»¤é‡æ’çš„ç»“æœå¯¹äºå•çº¿ç¨‹æ¥è¯´æ˜¯ä¸€è‡´æ€§ï¼Œæ²¡æœ‰ä»€ä¹ˆå½±å“ï¼ˆåœ¨æŒ‡ä»¤é‡æ’çš„è¿‡ç¨‹ä¸­ä¼šè€ƒè™‘æ•°æ®ä¾èµ–çš„é—®é¢˜ï¼‰ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹é¿å…æŒ‡ä»¤é‡æ’å¸¦æ¥ç¨‹åºæ‰§è¡Œé”™è¯¯çš„å±å®³ã€‚æœ‰äº›æƒ…å†µå¯ä»¥ä½¿ç”¨volatileï¼Œæˆ–è€…ä½¿ç”¨synchronizedåŒæ­¥å—æˆ–è€…åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥é”ã€‚</p>
<h2 id="6-javaå†…å­˜å¯è§æ€§">6. Javaå†…å­˜å¯è§æ€§
</h2><h3 id="11-ç›®æ ‡-5">1.1 ç›®æ ‡
</h3><ul>
<li>
<p>äº†è§£javaå†…å­˜æ¨¡å‹</p>
</li>
<li>
<p>ç†è§£javaå†…å­˜å¯è§æ€§</p>
</li>
</ul>
<h3 id="12-è·¯å¾„-5">1.2 è·¯å¾„
</h3><ol>
<li>javaå†…å­˜æ¨¡å‹ä»‹ç»</li>
<li>javaå†…å­˜å¯è§æ€§çš„ä»‹ç»</li>
</ol>
<h3 id="13-è®²è§£-5">1.3 è®²è§£
</h3><h3 id="31-äº†è§£javaå†…å­˜æ¨¡å‹">3.1 äº†è§£Javaå†…å­˜æ¨¡å‹
</h3><p>â€‹	JVMå†…å­˜ç»“æ„ã€Javaå¯¹è±¡æ¨¡å‹å’ŒJavaå†…å­˜æ¨¡å‹ï¼Œè¿™å°±æ˜¯ä¸‰ä¸ªæˆªç„¶ä¸åŒçš„æ¦‚å¿µï¼Œè€Œè¿™ä¸‰ä¸ªæ¦‚å¿µå¾ˆå®¹æ˜“æ··æ·†ã€‚è¿™é‡Œè¯¦ç»†åŒºåˆ«ä¸€ä¸‹</p>
<h4 id="311-jvmå†…å­˜ç»“æ„-è¿è¡Œæ—¶æ•°æ®åŒº">3.1.1 JVMå†…å­˜ç»“æ„; è¿è¡Œæ—¶æ•°æ®åŒº
</h4><p>â€‹	æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaä»£ç æ˜¯è¦è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ã€‚å…¶ä¸­æœ‰äº›åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œè€Œæœ‰äº›åŒºåŸŸåˆ™ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ã€‚</p>
<p>åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 8ï¼‰ã€‹ä¸­æè¿°äº†JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/p/juc_01/assets/QQ20180624-150918.png"
	width="675"
	height="350"
	
	loading="lazy"
	
		alt="QQ20180624-150918"
	
	
		class="gallery-image" 
		data-flex-grow="192"
		data-flex-basis="462px"
	
></p>
<p>â€‹	<strong>JVMå†…å­˜ç»“æ„ï¼Œç”±Javaè™šæ‹Ÿæœºè§„èŒƒå®šä¹‰ã€‚æè¿°çš„æ˜¯Javaç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±JVMç®¡ç†çš„ä¸åŒæ•°æ®åŒºåŸŸã€‚å„ä¸ªåŒºåŸŸæœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚</strong></p>
<h4 id="312-javaå¯¹è±¡æ¨¡å‹">3.1.2 Javaå¯¹è±¡æ¨¡å‹
</h4><p>â€‹	Javaæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œè€Œ<strong>Javaå¯¹è±¡</strong>åœ¨JVMä¸­çš„<strong>å­˜å‚¨</strong>ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„<strong>ç»“æ„</strong>çš„ã€‚è€Œè¿™ä¸ªå…³äºJavaå¯¹è±¡è‡ªèº«çš„å­˜å‚¨æ¨¡å‹ç§°ä¹‹ä¸ºJavaå¯¹è±¡æ¨¡å‹ã€‚</p>
<p>â€‹	HotSpotè™šæ‹Ÿæœºä¸­ï¼ˆSun JDKå’ŒOpenJDKä¸­æ‰€å¸¦çš„è™šæ‹Ÿæœºï¼Œä¹Ÿæ˜¯ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿çš„Javaè™šæ‹Ÿæœºï¼‰ï¼Œè®¾è®¡äº†ä¸€ä¸ªOOP-Klass Modelã€‚OOPï¼ˆOrdinary Object Pointerï¼‰æŒ‡çš„æ˜¯æ™®é€šå¯¹è±¡æŒ‡é’ˆï¼Œè€ŒKlassç”¨æ¥æè¿°å¯¹è±¡å®ä¾‹çš„å…·ä½“ç±»å‹ã€‚</p>
<p>â€‹	æ¯ä¸€ä¸ªJavaç±»ï¼Œåœ¨è¢«JVMåŠ è½½çš„æ—¶å€™ï¼ŒJVMä¼šç»™è¿™ä¸ªç±»åˆ›å»ºä¸€ä¸ª<code>instanceKlass</code>å¯¹è±¡ï¼Œä¿å­˜åœ¨æ–¹æ³•åŒºï¼Œç”¨æ¥åœ¨JVMå±‚è¡¨ç¤ºè¯¥Javaç±»ã€‚å½“æˆ‘ä»¬åœ¨Javaä»£ç ä¸­ï¼Œä½¿ç”¨newåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ª<code>instanceOopDesc</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­åŒ…å«äº†å¯¹è±¡å¤´ä»¥åŠå®ä¾‹æ•°æ®ã€‚</p>
<p><img src="/p/juc_01/assets/20170615230126453.jpeg"
	width="1588"
	height="712"
	
	loading="lazy"
	
		alt="20170615230126453"
	
	
		class="gallery-image" 
		data-flex-grow="223"
		data-flex-basis="535px"
	
></p>
<p>è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„Javaå¯¹è±¡çš„OOP-Klassæ¨¡å‹ï¼Œå³Javaå¯¹è±¡æ¨¡å‹ã€‚</p>
<h4 id="313-å†…å­˜æ¨¡å‹">3.1.3 å†…å­˜æ¨¡å‹
</h4><p>â€‹	<strong>Javaå†…å­˜æ¨¡å‹å°±æ˜¯ä¸€ç§ç¬¦åˆå†…å­˜æ¨¡å‹è§„èŒƒçš„ï¼Œå±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è®¿é—®å·®å¼‚çš„ï¼Œä¿è¯äº†Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹å¯¹å†…å­˜çš„è®¿é—®éƒ½èƒ½ä¿è¯æ•ˆæœä¸€è‡´çš„æœºåˆ¶åŠè§„èŒƒã€‚</strong></p>
<p>æœ‰å…´è¶£è¯¦ç»†äº†è§£Javaå†…å­˜æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æœ‰Javaå†…å­˜æ¨¡å‹ï¼ŒJavaå†…å­˜æ¨¡å‹è§£å†³äº†ä»€ä¹ˆé—®é¢˜çš„å­¦å‘˜ï¼Œå‚è€ƒï¼š<a class="link" href="https://www.hollischuang.com/archives/2550"  target="_blank" rel="noopener"
    >https://www.hollischuang.com/archives/2550</a>ã€‚</p>
<p>â€‹	Javaå†…å­˜æ¨¡å‹æ˜¯æ ¹æ®è‹±æ–‡Java Memory Modelï¼ˆJMMï¼‰ç¿»è¯‘è¿‡æ¥çš„ã€‚å…¶å®<strong>JMMå¹¶ä¸åƒJVMå†…å­˜ç»“æ„ä¸€æ ·æ˜¯çœŸå®å­˜åœ¨çš„ã€‚ä»–åªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µ</strong>ã€‚<a class="link" href="http://www.cs.umd.edu/~pugh/java/memoryModel/jsr133.pdf"  target="_blank" rel="noopener"
    >JSR-133: Java Memory Model and Thread Specification</a>ä¸­æè¿°äº†ï¼ŒJMMæ˜¯å’Œå¤šçº¿ç¨‹ç›¸å…³çš„ï¼Œä»–æè¿°äº†ä¸€ç»„è§„åˆ™æˆ–è§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå®šä¹‰äº†ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„ã€‚</p>
<p>â€‹	ç®€å•æ€»ç»“ä¸‹ï¼ŒJavaçš„å¤šçº¿ç¨‹ä¹‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œç”±äºé‡‡ç”¨å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¼šå­˜åœ¨ä¸€ç³»åˆ—å¦‚å¯è§æ€§ã€åŸå­æ€§ã€é¡ºåºæ€§ç­‰é—®é¢˜ï¼Œè€ŒJMMå°±æ˜¯å›´ç»•ç€å¤šçº¿ç¨‹é€šä¿¡ä»¥åŠä¸å…¶ç›¸å…³çš„ä¸€ç³»åˆ—ç‰¹æ€§è€Œå»ºç«‹çš„æ¨¡å‹ã€‚JMMå®šä¹‰äº†ä¸€äº›è¯­æ³•é›†ï¼Œè¿™äº›è¯­æ³•é›†æ˜ å°„åˆ°Javaè¯­è¨€ä¸­å°±æ˜¯volatileã€synchronizedç­‰å…³é”®å­—ã€‚</p>
<p><img src="/p/juc_01/assets/11.png"
	width="423"
	height="377"
	
	loading="lazy"
	
		alt="11"
	
	
		class="gallery-image" 
		data-flex-grow="112"
		data-flex-basis="269px"
	
></p>
<p>JMMçº¿ç¨‹æ“ä½œå†…å­˜çš„åŸºæœ¬çš„è§„åˆ™ï¼š</p>
<p>==ç¬¬ä¸€æ¡å…³äºçº¿ç¨‹ä¸ä¸»å†…å­˜ï¼šçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆæœ¬åœ°å†…å­˜ï¼‰ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å†™==</p>
<p>==ç¬¬äºŒæ¡å…³äºçº¿ç¨‹é—´æœ¬åœ°å†…å­˜ï¼šä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å…¶ä»–çº¿ç¨‹æœ¬åœ°å†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’éœ€è¦ç»è¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚==</p>
<ul>
<li>
<p><strong>ä¸»å†…å­˜</strong></p>
<p>ä¸»è¦å­˜å‚¨çš„æ˜¯Javaå®ä¾‹å¯¹è±¡ï¼Œæ‰€æœ‰çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹å¯¹è±¡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œä¸ç®¡è¯¥å®ä¾‹å¯¹è±¡æ˜¯æˆå‘˜å˜é‡è¿˜æ˜¯æ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡(ä¹Ÿç§°å±€éƒ¨å˜é‡)ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬äº†å…±äº«çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€‚ç”±äºæ˜¯å…±äº«æ•°æ®åŒºåŸŸï¼Œå¤šæ¡çº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œè®¿é—®å¯èƒ½ä¼šå‘ç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>æœ¬åœ°å†…å­˜</strong></p>
<p>ä¸»è¦å­˜å‚¨å½“å‰æ–¹æ³•çš„æ‰€æœ‰æœ¬åœ°å˜é‡ä¿¡æ¯(æœ¬åœ°å†…å­˜ä¸­å­˜å‚¨ç€ä¸»å†…å­˜ä¸­çš„å˜é‡å‰¯æœ¬æ‹·è´)ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼Œå³<strong>çº¿ç¨‹ä¸­çš„æœ¬åœ°å˜é‡å¯¹å…¶å®ƒçº¿ç¨‹æ˜¯ä¸å¯è§çš„</strong>ï¼Œå°±ç®—æ˜¯ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ˜¯åŒä¸€æ®µä»£ç ï¼Œå®ƒä»¬ä¹Ÿä¼šå„è‡ªåœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­åˆ›å»ºå±äºå½“å‰çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬äº†å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€ç›¸å…³Nativeæ–¹æ³•çš„ä¿¡æ¯ã€‚æ³¨æ„ç”±äºå·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œçº¿ç¨‹é—´æ— æ³•ç›¸äº’è®¿é—®å·¥ä½œå†…å­˜ï¼Œå› æ­¤å­˜å‚¨åœ¨å·¥ä½œå†…å­˜çš„æ•°æ®ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
</li>
</ul>
<h4 id="314-å°ç»“">3.1.4 å°ç»“
</h4><p>â€‹	JVMå†…å­˜ç»“æ„ï¼Œå’ŒJavaè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶åŒºåŸŸæœ‰å…³ã€‚</p>
<p>â€‹	Javaå¯¹è±¡æ¨¡å‹ï¼Œå’ŒJavaå¯¹è±¡å¦‚ä½•åœ¨jvmä¸­å­˜å‚¨çš„æè¿°ã€‚</p>
<p>â€‹    <strong>Javaå†…å­˜æ¨¡å‹ï¼Œå’ŒJavaçš„å¹¶å‘ç¼–ç¨‹æœ‰å…³</strong>ã€‚</p>
<h3 id="32-å†…å­˜å¯è§æ€§">3.2 å†…å­˜å¯è§æ€§
</h3><h4 id="321-å†…å­˜å¯è§æ€§ä»‹ç»">3.2.1 å†…å­˜å¯è§æ€§ä»‹ç»
</h4><p><code>å¯è§æ€§ï¼š</code>ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡å€¼çš„ä¿®æ”¹ï¼Œèƒ½å¤ŸåŠæ—¶çš„è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°</p>
<p><code>å…±äº«å˜é‡ï¼š</code>å¦‚æœä¸€ä¸ªå˜é‡åœ¨å¤šä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­éƒ½å­˜åœ¨å‰¯æœ¬ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±æ˜¯è¿™å‡ ä¸ªçº¿ç¨‹çš„å…±äº«å˜é‡</p>
<p>çº¿ç¨‹ A ä¸çº¿ç¨‹ B ä¹‹é—´å¦‚è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»è¦ç»å†ä¸‹é¢ 2 ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œçº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚</li>
<li>ç„¶åï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹ A ä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚</li>
</ol>
<p><img src="/p/juc_01/assets/2c452d147bf0d09b14b770d3990740cb.png"
	width="440"
	height="334"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="131"
		data-flex-basis="316px"
	
></p>
<p>â€‹	å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ¬åœ°å†…å­˜ A å’Œ B æœ‰ä¸»å†…å­˜ä¸­å…±äº«å˜é‡ x çš„å‰¯æœ¬ã€‚å‡è®¾åˆå§‹æ—¶ï¼Œè¿™ä¸‰ä¸ªå†…å­˜ä¸­çš„ x å€¼éƒ½ä¸º 0ã€‚çº¿ç¨‹ A åœ¨æ‰§è¡Œæ—¶ï¼ŒæŠŠæ›´æ–°åçš„ x å€¼ï¼ˆå‡è®¾å€¼ä¸º 1ï¼‰ä¸´æ—¶å­˜æ”¾åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ A ä¸­ã€‚å½“çº¿ç¨‹ A å’Œçº¿ç¨‹ B éœ€è¦é€šä¿¡æ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆä¼šæŠŠè‡ªå·±æœ¬åœ°å†…å­˜ä¸­ä¿®æ”¹åçš„ x å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œæ­¤æ—¶ä¸»å†…å­˜ä¸­çš„ x å€¼å˜ä¸ºäº† 1ã€‚éšåï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹ A æ›´æ–°åçš„ x å€¼ï¼Œæ­¤æ—¶çº¿ç¨‹ B çš„æœ¬åœ°å†…å­˜çš„ x å€¼ä¹Ÿå˜ä¸ºäº† 1ã€‚</p>
<p>â€‹	ä»æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤å®è´¨ä¸Šæ˜¯çº¿ç¨‹ A åœ¨å‘çº¿ç¨‹ B å‘é€æ¶ˆæ¯ï¼Œè€Œä¸”è¿™ä¸ªé€šä¿¡è¿‡ç¨‹å¿…é¡»è¦ç»è¿‡ä¸»å†…å­˜ã€‚JMM é€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæ¥ä¸º java ç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p>
<p>â€‹	<strong>å›é¡¾ä¸Šé¢å¤šçº¿ç¨‹å¹¶å‘çš„å¯è§æ€§é—®é¢˜çš„æ¡ˆä¾‹</strong></p>
<h2 id="7-volatile">7 Volatile
</h2><h3 id="71-ç›®æ ‡">7.1 ç›®æ ‡
</h3><ul>
<li>æŒæ¡volatileçš„ä½¿ç”¨æ–¹æ³•å’Œåœºæ™¯</li>
<li>ç†è§£volatileçš„ä½œç”¨åŸç†</li>
</ul>
<h3 id="72-è·¯å¾„">7.2 è·¯å¾„
</h3><ol>
<li>è§£å†³å†…å­˜å¯è§æ€§çš„é—®é¢˜</li>
<li>åŸå­æ€§çš„é—®é¢˜</li>
<li>volatileçš„é€‚ç”¨åœºæ™¯</li>
<li>synchronizedå’Œvolatileçš„å¯¹æ¯”</li>
</ol>
<h3 id="73-è®²è§£">7.3 è®²è§£
</h3><p>å¦‚æœä¸€ä¸ªå˜é‡ä½¿ç”¨volatileï¼Œåˆ™å®ƒæ¯”ä½¿ç”¨synchronizedçš„æˆæœ¬æ›´åŠ ä½ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚</p>
<p>Javaè¯­è¨€è§„èŒƒå¯¹volatileçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><code>Javaå…è®¸çº¿ç¨‹è®¿é—®å…±äº«å˜é‡ï¼Œä¸ºäº†ç¡®ä¿å…±äº«å˜é‡èƒ½è¢«å‡†ç¡®å’Œä¸€è‡´åœ°æ›´æ–°ï¼Œçº¿ç¨‹åº”è¯¥ç¡®ä¿é€šè¿‡æ’ä»–é”å•ç‹¬è·å¾—è¿™ä¸ªå˜é‡ã€‚</code></p>
<p>â€‹	é€šä¿—ç‚¹è®²å°±æ˜¯è¯´ä¸€ä¸ªå˜é‡å¦‚æœç”¨volatileä¿®é¥°äº†ï¼Œåˆ™Javaå¯ä»¥ç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å¯¹volatileä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œæ›´æ–°ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹é©¬çœ‹åˆ°è¿™ä¸ªæ›´æ–°ï¼Œè¿™å°±æ˜¯å†…å­˜å¯è§æ€§ã€‚</p>
<p>volatileè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨èµ·æ¥æ— éå°±æ˜¯åœ¨ä¸€ä¸ªå˜é‡å‰é¢åŠ ä¸Švolatileå³å¯ï¼Œä½†æ˜¯è¦ç”¨å¥½å¹¶ä¸å®¹æ˜“ã€‚</p>
<h4 id="1-è§£å†³å†…å­˜å¯è§æ€§é—®é¢˜">1 è§£å†³å†…å­˜å¯è§æ€§é—®é¢˜
</h4><h5 id="11-ç¼“å­˜ä¸€è‡´åè®®ä¿è¯è¯»åˆ°æœ€æ–°å€¼">1.1 ç¼“å­˜ä¸€è‡´åè®®ä¿è¯è¯»åˆ°æœ€æ–°å€¼
</h5><p>è®¾ç½®-XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly å¯ä»¥æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ±‡ç¼–ç </p>
<pre><code>æ±‡ç¼–ä»£ç ï¼š

0x01a3de1d: movb $0x0,0x1104800(%esi);

0x01a3de24: lock  addl $0x0,(%esp);
</code></pre>
<p>æœ‰volatileå˜é‡ä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œ<strong>å†™æ“ä½œ</strong>çš„æ—¶å€™ä¼šå¤šç¬¬äºŒè¡Œæ±‡ç¼–ä»£ç ï¼Œé€šè¿‡æŸ¥IA-32æ¶æ„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œå¯çŸ¥ï¼Œlockå‰ç¼€çš„æŒ‡ä»¤åœ¨å¤šæ ¸å¤„ç†å™¨ä¸‹ä¼šå¼•å‘äº†ä¸¤ä»¶äº‹æƒ…ã€‚</p>
<ul>
<li><strong>å°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®ä¼šå†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚</strong></li>
<li><strong>è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šå¼•èµ·åœ¨å…¶ä»–CPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆã€‚</strong></li>
</ul>
<p>å¤„ç†å™¨ä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼Œä¸ç›´æ¥å’Œå†…å­˜è¿›è¡Œé€šè®¯ï¼Œè€Œæ˜¯å…ˆå°†ç³»ç»Ÿå†…å­˜çš„æ•°æ®è¯»åˆ°å†…éƒ¨ç¼“å­˜ï¼ˆL1,L2æˆ–å…¶ä»–ï¼‰åå†è¿›è¡Œæ“ä½œï¼Œä½†æ“ä½œå®Œä¹‹åä¸çŸ¥é“ä½•æ—¶ä¼šå†™åˆ°å†…å­˜ï¼Œå¦‚æœå¯¹å£°æ˜äº†Volatileå˜é‡è¿›è¡Œå†™æ“ä½œï¼ŒJVMå°±ä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡Lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªå˜é‡æ‰€åœ¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚ä½†æ˜¯å°±ç®—å†™å›åˆ°å†…å­˜ï¼Œå¦‚æœå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„å€¼è¿˜æ˜¯æ—§çš„ï¼Œå†æ‰§è¡Œè®¡ç®—æ“ä½œå°±ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®ç°<strong>ç¼“å­˜ä¸€è‡´æ€§åè®®</strong>ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯<strong>è¿‡æœŸ</strong>äº†ï¼Œå½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„<strong>å†…å­˜åœ°å€</strong>è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„<strong>ç¼“å­˜è¡Œè®¾ç½®</strong>æˆ<strong>æ— æ•ˆçŠ¶æ€</strong>ï¼Œå½“å¤„ç†å™¨è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼š<strong>å¼ºåˆ¶</strong>é‡æ–°ä»<strong>ç³»ç»Ÿå†…å­˜</strong>é‡ŒæŠŠæ•°æ®è¯»åˆ°<strong>å¤„ç†å™¨ç¼“å­˜</strong>é‡Œã€‚</p>
<p>è¿™ä¸¤ä»¶äº‹æƒ…åœ¨IA-32è½¯ä»¶å¼€å‘è€…æ¶æ„æ‰‹å†Œçš„ç¬¬ä¸‰å†Œçš„å¤šå¤„ç†å™¨ç®¡ç†ç« èŠ‚ï¼ˆç¬¬å…«ç« ï¼‰ä¸­æœ‰è¯¦ç»†é˜è¿°ã€‚</p>
<p>Lockå‰ç¼€æŒ‡ä»¤ä¼šå¼•èµ·å¤„ç†å™¨ç¼“å­˜å›å†™åˆ°å†…å­˜ ã€‚Lockå‰ç¼€æŒ‡ä»¤å¯¼è‡´åœ¨æ‰§è¡ŒæŒ‡ä»¤æœŸé—´ï¼Œå£°è¨€å¤„ç†å™¨çš„ LOCK# ä¿¡å·ã€‚åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ï¼ŒLOCK# ä¿¡å·ç¡®ä¿åœ¨å£°è¨€è¯¥ä¿¡å·æœŸé—´ï¼Œå¤„ç†å™¨å¯ä»¥ç‹¬å ä½¿ç”¨ä»»ä½•å…±äº«å†…å­˜ã€‚ï¼ˆå› ä¸ºå®ƒä¼šé”ä½æ€»çº¿ï¼Œå¯¼è‡´å…¶ä»–CPUä¸èƒ½è®¿é—®æ€»çº¿ï¼Œä¸èƒ½è®¿é—®æ€»çº¿å°±æ„å‘³ç€ä¸èƒ½è®¿é—®ç³»ç»Ÿå†…å­˜ï¼‰ï¼Œä½†æ˜¯åœ¨æœ€è¿‘çš„å¤„ç†å™¨é‡Œï¼ŒLOCKï¼ƒä¿¡å·ä¸€èˆ¬ä¸é”æ€»çº¿ï¼Œè€Œæ˜¯é”ç¼“å­˜ï¼Œæ¯•ç«Ÿé”æ€»çº¿å¼€é”€æ¯”è¾ƒå¤§ã€‚åœ¨8.1.4ç« èŠ‚æœ‰è¯¦ç»†è¯´æ˜é”å®šæ“ä½œå¯¹å¤„ç†å™¨ç¼“å­˜çš„å½±å“ï¼Œå¯¹äºIntel486å’ŒPentiumå¤„ç†å™¨ï¼Œåœ¨é”æ“ä½œæ—¶ï¼Œæ€»æ˜¯åœ¨æ€»çº¿ä¸Šå£°è¨€LOCK#ä¿¡å·ã€‚ä½†åœ¨P6å’Œæœ€è¿‘çš„å¤„ç†å™¨ä¸­ï¼Œå¦‚æœè®¿é—®çš„å†…å­˜åŒºåŸŸå·²ç»ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œåˆ™ä¸ä¼šå£°è¨€LOCK#ä¿¡å·ã€‚ç›¸ååœ°ï¼Œå®ƒä¼šé”å®šè¿™å—å†…å­˜åŒºåŸŸçš„ç¼“å­˜å¹¶å›å†™åˆ°å†…å­˜ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ï¼Œæ­¤æ“ä½œè¢«ç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹è¢«ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ® ã€‚</p>
<p>ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜å›å†™åˆ°å†…å­˜ä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ ã€‚IA-32å¤„ç†å™¨å’ŒIntel 64å¤„ç†å™¨ä½¿ç”¨MESIï¼ˆä¿®æ”¹ï¼Œç‹¬å ï¼Œå…±äº«ï¼Œæ— æ•ˆï¼‰æ§åˆ¶åè®®å»ç»´æŠ¤å†…éƒ¨ç¼“å­˜å’Œå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„ä¸€è‡´æ€§ã€‚åœ¨å¤šæ ¸å¤„ç†å™¨ç³»ç»Ÿä¸­è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼ŒIA-32 å’ŒIntel 64å¤„ç†å™¨èƒ½å—…æ¢å…¶ä»–å¤„ç†å™¨è®¿é—®ç³»ç»Ÿå†…å­˜å’Œå®ƒä»¬çš„å†…éƒ¨ç¼“å­˜ã€‚å®ƒä»¬ä½¿ç”¨å—…æ¢æŠ€æœ¯ä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜ï¼Œç³»ç»Ÿå†…å­˜å’Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´ã€‚ä¾‹å¦‚åœ¨Pentiumå’ŒP6 familyå¤„ç†å™¨ä¸­ï¼Œå¦‚æœé€šè¿‡å—…æ¢ä¸€ä¸ªå¤„ç†å™¨æ¥æ£€æµ‹å…¶ä»–å¤„ç†å™¨æ‰“ç®—å†™å†…å­˜åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€å½“å‰å¤„ç†å…±äº«çŠ¶æ€ï¼Œé‚£ä¹ˆæ­£åœ¨å—…æ¢çš„å¤„ç†å™¨å°†æ— æ•ˆå®ƒçš„ç¼“å­˜è¡Œï¼Œåœ¨ä¸‹æ¬¡è®¿é—®ç›¸åŒå†…å­˜åœ°å€æ—¶ï¼Œå¼ºåˆ¶æ‰§è¡Œç¼“å­˜è¡Œå¡«å……ã€‚</p>
<h5 id="12-å†…å­˜å±éšœé˜²æ­¢æŒ‡ä»¤é‡æ’è§£å†³æŒ‡ä»¤é‡æ’å¯¹volatileä¿®é¥°çš„å˜é‡ä¸ä¼šäº§ç”Ÿå½±å“">1.2 å†…å­˜å±éšœé˜²æ­¢æŒ‡ä»¤é‡æ’ï¼ˆè§£å†³æŒ‡ä»¤é‡æ’å¯¹volatileä¿®é¥°çš„å˜é‡ä¸ä¼šäº§ç”Ÿå½±å“ï¼‰
</h5><p>å†™æ“ä½œæ—¶ï¼Œé€šè¿‡åœ¨å†™æ“ä½œæŒ‡ä»¤ååŠ å…¥ä¸€æ¡storeå±éšœæŒ‡ä»¤ï¼Œè®©æœ¬åœ°å†…å­˜ä¸­å˜é‡çš„å€¼èƒ½å¤Ÿåˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</p>
<p>è¯»æ“ä½œæ—¶ï¼Œé€šè¿‡åœ¨è¯»æ“ä½œå‰åŠ å…¥ä¸€æ¡loadå±éšœæŒ‡ä»¤ï¼ŒåŠæ—¶è¯»å–åˆ°å˜é‡åœ¨ä¸»å†…å­˜çš„å€¼</p>
<p><code>PS: å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰æ˜¯ä¸€ç§CPUæŒ‡ä»¤ï¼Œç”¨äºæ§åˆ¶ç‰¹å®šæ¡ä»¶ä¸‹çš„é‡æ’åºå’Œå†…å­˜å¯è§æ€§é—®é¢˜ã€‚Javaç¼–è¯‘å™¨ä¹Ÿä¼šæ ¹æ®å†…å­˜å±éšœçš„è§„åˆ™ç¦æ­¢é‡æ’åº</code></p>
<p>==volatileçš„åº•å±‚å®ç°æ˜¯é€šè¿‡æ’å…¥å†…å­˜å±éšœ==ï¼Œä½†æ˜¯å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘ç°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å†…å­˜å±éšœçš„æ€»æ•°å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥ï¼ŒJMMé‡‡ç”¨äº†ä¿å®ˆç­–ç•¥ã€‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>StoreStoreå±éšœå¯ä»¥ä¿è¯åœ¨volatileå†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œéƒ½å·²ç»åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚</p>
</li>
<li>
<p>StoreLoadå±éšœçš„ä½œç”¨æ˜¯é¿å…volatileå†™ä¸åé¢å¯èƒ½æœ‰çš„volatileè¯»/å†™æ“ä½œé‡æ’åºã€‚</p>
</li>
<li>
<p>LoadLoadå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸ä¸‹é¢çš„æ™®é€šè¯»é‡æ’åºã€‚</p>
</li>
<li>
<p>LoadStoreå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸ä¸‹é¢çš„æ™®é€šå†™é‡æ’åºã€‚</p>
</li>
</ul>
<h4 id="2-åŸå­æ€§çš„é—®é¢˜">2 åŸå­æ€§çš„é—®é¢˜
</h4><p>è™½ç„¶Volatile å…³é”®å­—å¯ä»¥è®©å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯è§ï¼Œä½†æ˜¯Volatileä¸èƒ½ä¿è¯å¯¹ä¿®é¥°å˜é‡çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p>
<pre><code class="language-java">public class Demo3Volatile {

    public static void main(String[] args) throws InterruptedException {
        VolatileDemo demo = new VolatileDemo();

        for (int i = 0; i &lt; 5; i++) {
            Thread t = new Thread(demo);
            t.start();
        }

        Thread.sleep(1000);
        System.out.println(demo.count);
    }

    static class VolatileDemo implements Runnable {
        public volatile int count;
        //public volatile AtomicInteger count = new AtomicInteger(0);

        public void run() {
            addCount();
        }

        public void addCount() {
            for (int i = 0; i &lt; 10000; i++) {
                count++;
            }
        }
    }
}
</code></pre>
<p>ä»¥ä¸Šå‡ºç°åŸå­æ€§é—®é¢˜çš„åŸå› æ˜¯count++å¹¶ä¸æ˜¯åŸå­æ€§æ“ä½œã€‚</p>
<p>count = 5 å¼€å§‹ï¼Œæµç¨‹åˆ†æï¼š</p>
<ol>
<li>çº¿ç¨‹1è¯»å–countçš„å€¼ä¸º5</li>
<li>çº¿ç¨‹2è¯»å–countçš„å€¼ä¸º5</li>
<li>çº¿ç¨‹2åŠ 1æ“ä½œ</li>
<li>çº¿ç¨‹2æœ€æ–°countçš„å€¼ä¸º6</li>
<li>çº¿ç¨‹2å†™å…¥å€¼åˆ°ä¸»å†…å­˜çš„æœ€æ–°å€¼ä¸º6</li>
</ol>
<p>è¿™ä¸ªæ—¶å€™ï¼Œçº¿ç¨‹1çš„countä¸º5ï¼Œçº¿ç¨‹2çš„countä¸º6</p>
<p>å¦‚æœåˆ‡æ¢åˆ°çº¿ç¨‹1æ‰§è¡Œï¼Œé‚£ä¹ˆçº¿ç¨‹1å¾—åˆ°çš„ç»“æœæ˜¯6ï¼Œå†™å…¥åˆ°ä¸»å†…å­˜çš„å€¼è¿˜æ˜¯6</p>
<p>ç°åœ¨çš„æƒ…å†µæ˜¯å¯¹countè¿›è¡Œäº†ä¸¤æ¬¡åŠ 1æ“ä½œï¼Œä½†æ˜¯ä¸»å†…å­˜å®é™…ä¸Šåªæ˜¯åŠ 1ä¸€æ¬¡</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>ä½¿ç”¨synchronized</li>
<li>ä½¿ç”¨ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰</li>
<li>ä½¿ç”¨AtomicIntegerï¼ˆåŸå­æ“ä½œï¼‰</li>
</ol>
<p>ä½¿ç”¨synchronized</p>
<pre><code class="language-java">public synchronized void addCount() {
    for (int i = 0; i &lt; 10000; i++) {
        count++;
    }
}
</code></pre>
<p>ä½¿ç”¨ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰</p>
<pre><code class="language-java">//å¯é‡å…¥é”
private Lock lock = new ReentrantLock();

public void addCount() {
    for (int i = 0; i &lt; 10000; i++) {
        lock.lock();
        count++;
        lock.unlock();
    }
}
</code></pre>
<p>ä½¿ç”¨AtomicIntegerï¼ˆåŸå­æ“ä½œï¼‰</p>
<pre><code class="language-java">public static AtomicInteger count = new AtomicInteger(0);
public void addCount() {
    for (int i = 0; i &lt; 10000; i++) {
        //count++;
        count.incrementAndGet();
    }
}
</code></pre>
<h4 id="3-volatile-é€‚åˆä½¿ç”¨åœºæ™¯èƒ½å¤Ÿè§£å†³å¯è§æ€§å’Œä¸€å®šç¨‹åº¦çš„æœ‰åºæ€§ä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§">3 Volatile é€‚åˆä½¿ç”¨åœºæ™¯ï¼ˆèƒ½å¤Ÿè§£å†³å¯è§æ€§ï¼Œå’Œä¸€å®šç¨‹åº¦çš„æœ‰åºæ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§ï¼‰
</h4><p>aï¼‰å¯¹å˜é‡çš„å†™å…¥æ“ä½œä¸ä¾èµ–å…¶å½“å‰å€¼</p>
<p>â€‹    	ä¸æ»¡è¶³ï¼šnumber++ã€count=count*5ç­‰</p>
<p>â€‹    	æ»¡è¶³ï¼šbooleanå˜é‡ã€ç›´æ¥èµ‹å€¼çš„å˜é‡ç­‰</p>
<p>bï¼‰è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­</p>
<p>â€‹	ä¸æ»¡è¶³ï¼šä¸å˜å¼ low&lt;up</p>
<p>æ€»ç»“ï¼šå¯¹å˜é‡çš„æ“ä½œæœ¬èº«æ˜¯åŸå­æ€§çš„æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨volatile,å¦‚æœä¸æ˜¯åŸå­æ“ä½œä½¿ç”¨äº†volitaleä¹Ÿä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨</p>
<p>æ‰©å±•ï¼š</p>
<pre><code class="language-txt">Javaä¸­çš„åŸå­æ“ä½œåŒ…æ‹¬ï¼š
1ï¼‰é™¤longå’Œdoubleä¹‹å¤–çš„åŸºæœ¬ç±»å‹çš„èµ‹å€¼æ“ä½œ
2ï¼‰æ‰€æœ‰å¼•ç”¨referenceçš„èµ‹å€¼æ“ä½œ
3ï¼‰java.util.concurrent.Atomic.* åŒ…ä¸­æ‰€æœ‰ç±»çš„ä¸€åˆ‡æ“ä½œã€‚
4ï¼‰casæ“ä½œæ˜¯åŸå­æ“ä½œã€‚

ä½†æ˜¯javaå¯¹longå’Œdoubleçš„èµ‹å€¼æ“ä½œæ˜¯éåŸå­æ“ä½œï¼ï¼longå’Œdoubleå ç”¨çš„å­—èŠ‚æ•°éƒ½æ˜¯8ï¼Œä¹Ÿå°±æ˜¯64bitsã€‚åœ¨32ä½æ“ä½œç³»ç»Ÿä¸Šå¯¹64ä½çš„æ•°æ®çš„è¯»å†™è¦åˆ†ä¸¤æ­¥å®Œæˆï¼Œæ¯ä¸€æ­¥å–32ä½æ•°æ®ã€‚è¿™æ ·å¯¹doubleå’Œlongçš„èµ‹å€¼æ“ä½œå°±ä¼šæœ‰é—®é¢˜ï¼šå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å†™ä¸€ä¸ªå˜é‡å†…å­˜ï¼Œä¸€ä¸ªè¿›ç¨‹å†™ä½32ä½ï¼Œè€Œå¦ä¸€ä¸ªå†™é«˜32ä½ï¼Œè¿™æ ·å°†å¯¼è‡´è·å–çš„64ä½æ•°æ®æ˜¯å¤±æ•ˆçš„æ•°æ®ã€‚å› æ­¤éœ€è¦ä½¿ç”¨volatileå…³é”®å­—æ¥é˜²æ­¢æ­¤ç±»ç°è±¡ã€‚volatileæœ¬èº«ä¸ä¿è¯è·å–å’Œè®¾ç½®æ“ä½œçš„åŸå­æ€§ï¼Œä»…ä»…ä¿æŒä¿®æ”¹çš„å¯è§æ€§ã€‚ä½†æ˜¯javaçš„å†…å­˜æ¨¡å‹ä¿è¯å£°æ˜ä¸ºvolatileçš„longå’Œdoubleå˜é‡çš„getå’Œsetæ“ä½œæ˜¯åŸå­çš„ã€‚
</code></pre>
<h3 id="74-å°ç»“">7.4 å°ç»“
</h3><h2 id="8-synchronized">8. synchronized
</h2><h3 id="81-ç›®æ ‡">8.1 ç›®æ ‡
</h3><ul>
<li>ç†è§£synchronizedå®ç°å¯è§æ€§çš„è¿‡ç¨‹</li>
<li>ç†è§£åŒæ­¥åŸç†</li>
<li>ç†è§£jvmæ˜¯å¦‚ä½•è¿›è¡Œé”ä¼˜åŒ–çš„</li>
</ul>
<h3 id="82-è·¯å¾„">8.2 è·¯å¾„
</h3><ol>
<li>è§£å†³å¯è§æ€§é—®é¢˜</li>
<li>åŒæ­¥åŸç†</li>
<li>é”ä¼˜åŒ–</li>
</ol>
<h3 id="83-è®²è§£">8.3 è®²è§£
</h3><p>â€‹	synchronizedå¯ä»¥ä¿è¯æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨è¿è¡Œæ—¶ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œsynchronizedå£°æ˜çš„ä»£ç å—ã€‚è¿˜å¯ä»¥ä¿è¯å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œè¿™éƒ¨åˆ†ä»£ç å—çš„é‡æ’åºä¹Ÿä¸ä¼šå½±å“å…¶æ‰§è¡Œç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨äº†synchronizedå¯ä»¥ä¿è¯å¹¶å‘çš„åŸå­æ€§ï¼Œå¯è§æ€§ï¼Œæœ‰åºæ€§ã€‚</p>
<h4 id="831-è§£å†³å¯è§æ€§é—®é¢˜">8.3.1 è§£å†³å¯è§æ€§é—®é¢˜
</h4><p>JMMå…³äºsynchronizedçš„ä¸¤æ¡è§„å®šï¼š</p>
<p>==çº¿ç¨‹åŠ é”æ—¶ï¼ˆè¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼‰ï¼šå°†æ¸…ç©ºæœ¬åœ°å†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ï¼Œä»è€Œä½¿ç”¨å…±äº«å˜é‡æ—¶éœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–æœ€æ–°çš„å€¼ï¼ˆåŠ é”ä¸è§£é”æ˜¯åŒä¸€æŠŠé”==ï¼‰</p>
<p>çº¿ç¨‹è§£é”å‰ï¼ˆé€€å‡ºåŒæ­¥ä»£ç å—æ—¶ï¼‰ï¼šå¿…é¡»æŠŠè‡ªå·±å·¥ä½œå†…å­˜ä¸­å…±äº«å˜é‡çš„æœ€æ–°å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</p>
<p>åšå¦‚ä¸‹ä¿®æ”¹ï¼Œåœ¨æ­»å¾ªç¯ä¸­æ·»åŠ åŒæ­¥ä»£ç å—</p>
<pre><code class="language-java">        while (flag) {
            synchronized (this) {
            }
        }
</code></pre>
<p>synchronizedå®ç°å¯è§æ€§çš„è¿‡ç¨‹</p>
<ol>
<li>è·å¾—äº’æ–¥é”ï¼ˆåŒæ­¥è·å–é”ï¼‰</li>
<li>æ¸…ç©ºæœ¬åœ°å†…å­˜</li>
<li>æ‰§è¡Œä»£ç </li>
<li>å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜</li>
<li>é‡Šæ”¾äº’æ–¥é”</li>
<li>é‡æ–°å¾ªç¯ï¼Œä»ä¸»å†…å­˜æ‹·è´å˜é‡çš„æœ€æ–°å‰¯æœ¬åˆ°æœ¬åœ°å†…å­˜</li>
</ol>
<h4 id="832-åŒæ­¥åŸç†">8.3.2 åŒæ­¥åŸç†
</h4><p>synchronizedçš„åŒæ­¥å¯ä»¥è§£å†³åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§çš„é—®é¢˜ï¼Œé‚£æ˜¯å¦‚ä½•å®ç°åŒæ­¥çš„å‘¢ï¼Ÿ</p>
<p>Javaä¸­æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ï¼Œè¿™æ˜¯synchronizedå®ç°åŒæ­¥çš„åŸºç¡€ï¼š</p>
<ol>
<li>æ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡this</li>
<li>é™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„classå¯¹è±¡</li>
<li>åŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯æ‹¬å·é‡Œé¢çš„å¯¹è±¡</li>
</ol>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆæ˜¯éœ€è¦å¾—åˆ°é”æ‰èƒ½æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå½“é€€å‡ºæˆ–è€…æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»è¦é‡Šæ”¾é”ã€‚</p>
<p>synchronizedçš„åŒæ­¥æ“ä½œä¸»è¦æ˜¯monitorenterå’Œmonitorexitè¿™ä¸¤ä¸ªjvmæŒ‡ä»¤å®ç°çš„ï¼Œå…ˆå†™ä¸€æ®µç®€å•çš„ä»£ç ï¼š</p>
<pre><code class="language-java">public class Demo2Synchronized {
    public void test2() {
        synchronized (this) {
        }
    }
}
</code></pre>
<p>åœ¨cmdå‘½ä»¤è¡Œæ‰§è¡Œjavacç¼–è¯‘å’Œjavap -c Java å­—èŠ‚ç çš„æŒ‡ä»¤</p>
<pre><code>javac Demo2Synchronized.java
javap -c Demo2Synchronized.class
</code></pre>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒåŒæ­¥ä»£ç å—æ˜¯ä½¿ç”¨monitorenterå’Œmonitorexitè¿™ä¸¤ä¸ªjvmæŒ‡ä»¤å®ç°çš„ï¼š</p>
<p><img src="/p/juc_01/assets/1558750061740.png"
	width="819"
	height="625"
	
	loading="lazy"
	
		alt="50061740"
	
	
		class="gallery-image" 
		data-flex-grow="131"
		data-flex-basis="314px"
	
></p>
<p>â€‹	æ³¨æ„ï¼Œæœ¬å°èŠ‚æ˜¯è§£é‡Šsynchronizedæ€§èƒ½ä½æ•ˆçš„åŸå› ï¼Œåªè¦èƒ½ç†è§£synchronizedåŒæ­¥è¿‡ç¨‹å…¶å®è¿˜éœ€è¦åšå¾ˆå¤šäº‹ï¼Œè¿™äº›é€»è¾‘çš„æ‰§è¡Œéƒ½éœ€è¦å ç”¨èµ„æºï¼Œä»è€Œå¯¼è‡´æ€§èƒ½è¾ƒä½ã€‚è¿™éƒ¨åˆ†åˆ†æè¿‡äºæ·±å…¥JMMåº•å±‚åŸç†ï¼Œä¸é€‚åˆåˆçº§ç”šè‡³ä¸­çº§ç¨‹åºå‘˜å­¦ä¹ ã€‚synchronizedæ˜¯é€šè¿‡è®¿é—®é”å¯¹è±¡çš„monitorå’Œmark wordå®ç°åŒæ­¥çš„</p>
<p><strong>Mark Word</strong></p>
<pre><code>Hotspotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚å…¶ä¸­Klass Pointæ˜¯æ˜¯å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ï¼ŒMark Wordç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå®ƒæ˜¯synchronizedå®ç°è½»é‡çº§é”å’Œåå‘é”çš„å…³é”®ã€‚
  
Mark Wordç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚**å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³**ç­‰ç­‰ã€‚Javaå¯¹è±¡å¤´ä¸€èˆ¬å æœ‰ä¸¤ä¸ªæœºå™¨ç ï¼ˆåœ¨32ä½è™šæ‹Ÿæœºä¸­ï¼Œ1ä¸ªæœºå™¨ç ç­‰äº4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯32bitï¼‰ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™éœ€è¦ä¸‰ä¸ªæœºå™¨ç ï¼Œå› ä¸ºJVMè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡Javaå¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ç¡®å®šJavaå¯¹è±¡çš„å¤§å°ï¼Œä½†æ˜¯æ— æ³•ä»æ•°ç»„çš„å…ƒæ•°æ®æ¥ç¡®è®¤æ•°ç»„çš„å¤§å°ï¼Œæ‰€ä»¥ç”¨ä¸€å—æ¥è®°å½•æ•°ç»„é•¿åº¦ã€‚ä¸‹å›¾æ˜¯Javaå¯¹è±¡å¤´çš„å­˜å‚¨ç»“æ„ï¼ˆ32ä½è™šæ‹Ÿæœºï¼‰ï¼š
</code></pre>
<p><img src="/p/juc_01/assets/201812081002.png"
	width="560"
	height="73"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="767"
		data-flex-basis="1841px"
	
></p>
<pre><code>å¯¹è±¡å¤´ä¿¡æ¯æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰çš„æ•°æ®æ— å…³çš„é¢å¤–å­˜å‚¨æˆæœ¬ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´æ•ˆç‡ï¼ŒMark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒMark Wordä¼šéšç€ç¨‹åºçš„è¿è¡Œå‘ç”Ÿå˜åŒ–ï¼Œå˜åŒ–çŠ¶æ€å¦‚ä¸‹ï¼ˆ32ä½è™šæ‹Ÿæœºï¼‰ï¼š
</code></pre>
<p><img src="/p/juc_01/assets/201812081003.png"
	width="812"
	height="204"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="398"
		data-flex-basis="955px"
	
></p>
<ul>
<li>
<p><strong>monitor</strong></p>
<p>ä»€ä¹ˆæ˜¯Monitorï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·ï¼Œä¹Ÿå¯ä»¥æè¿°ä¸ºä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå®ƒé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚ä¸ä¸€åˆ‡çš†å¯¹è±¡ä¸€æ ·ï¼Œæ‰€æœ‰çš„Javaå¯¹è±¡æ˜¯å¤©ç”Ÿçš„Monitorï¼Œæ¯ä¸€ä¸ªJavaå¯¹è±¡éƒ½æœ‰æˆä¸ºMonitorçš„æ½œè´¨ï¼Œå› ä¸ºåœ¨Javaçš„è®¾è®¡ä¸­ ï¼Œæ¯ä¸€ä¸ªJavaå¯¹è±¡éƒ½å¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œå®ƒå«åšå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚</p>
<p>Monitor æ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ˆå¯¹è±¡å¤´çš„MarkWordä¸­çš„LockWordæŒ‡å‘monitorçš„èµ·å§‹åœ°å€ï¼‰ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚å…¶ç»“æ„å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<p><img src="/p/juc_01/assets/201812081004.png"
	width="347"
	height="479"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="72"
		data-flex-basis="173px"
	
></p>
<ul>
<li><strong>Owner</strong>ï¼šåˆå§‹æ—¶ä¸ºNULLè¡¨ç¤ºå½“å‰æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰è¯¥monitor recordï¼Œå½“çº¿ç¨‹æˆåŠŸæ‹¥æœ‰è¯¥é”åä¿å­˜çº¿ç¨‹å”¯ä¸€æ ‡è¯†ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶åˆè®¾ç½®ä¸ºNULLï¼›</li>
<li><strong>EntryQ</strong>:å…³è”ä¸€ä¸ªç³»ç»Ÿäº’æ–¥é”ï¼ˆsemaphoreï¼‰ï¼Œé˜»å¡æ‰€æœ‰è¯•å›¾é”ä½monitor recordå¤±è´¥çš„çº¿ç¨‹ã€‚</li>
<li><strong>RcThis</strong>:è¡¨ç¤ºblockedæˆ–waitingåœ¨è¯¥monitor recordä¸Šçš„æ‰€æœ‰çº¿ç¨‹çš„ä¸ªæ•°ã€‚</li>
<li><strong>Nest</strong>:ç”¨æ¥å®ç°é‡å…¥é”çš„è®¡æ•°ã€‚</li>
<li><strong>HashCode</strong>:ä¿å­˜ä»å¯¹è±¡å¤´æ‹·è´è¿‡æ¥çš„HashCodeå€¼ï¼ˆå¯èƒ½è¿˜åŒ…å«GC ageï¼‰ã€‚</li>
<li><strong>Candidate</strong>:ç”¨æ¥é¿å…ä¸å¿…è¦çš„é˜»å¡æˆ–ç­‰å¾…çº¿ç¨‹å”¤é†’ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸæ‹¥æœ‰é”ï¼Œå¦‚æœæ¯æ¬¡å‰ä¸€ä¸ªé‡Šæ”¾é”çš„çº¿ç¨‹å”¤é†’æ‰€æœ‰æ­£åœ¨é˜»å¡æˆ–ç­‰å¾…çš„çº¿ç¨‹ï¼Œä¼šå¼•èµ·ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆä»é˜»å¡åˆ°å°±ç»ªç„¶åå› ä¸ºç«äº‰é”å¤±è´¥åˆè¢«é˜»å¡ï¼‰ä»è€Œå¯¼è‡´æ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚Candidateåªæœ‰ä¸¤ç§å¯èƒ½çš„å€¼0è¡¨ç¤ºæ²¡æœ‰éœ€è¦å”¤é†’çš„çº¿ç¨‹1è¡¨ç¤ºè¦å”¤é†’ä¸€ä¸ªç»§ä»»çº¿ç¨‹æ¥ç«äº‰é”ã€‚</li>
</ul>
<h4 id="833-synchronizedå’Œvolatileæ¯”è¾ƒ">8.3.3 synchronizedå’Œvolatileæ¯”è¾ƒ
</h4><p>aï¼‰volatileä¸éœ€è¦åŠ é”ï¼Œæ¯”synchronizedæ›´è½»ä¾¿ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹</p>
<p>bï¼‰synchronizedæ—¢èƒ½ä¿è¯å¯è§æ€§ï¼Œåˆèƒ½ä¿è¯åŸå­æ€§ï¼Œè€Œvolatileåªèƒ½ä¿è¯å¯è§æ€§ï¼Œæ— æ³•ä¿è¯åŸå­æ€§</p>
<p>â€‹	ä¸é”ç›¸æ¯”ï¼ŒVolatile å˜é‡æ˜¯ä¸€ç§éå¸¸ç®€å•ä½†åŒæ—¶åˆéå¸¸è„†å¼±çš„åŒæ­¥æœºåˆ¶ï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å°†æä¾›ä¼˜äºé”çš„æ€§èƒ½å’Œä¼¸ç¼©æ€§ã€‚å¦‚æœä¸¥æ ¼éµå¾ª volatile çš„ä½¿ç”¨æ¡ä»¶ï¼ˆ<strong>å¯¹å˜é‡çš„æ“ä½œæ˜¯åŸå­æ€§çš„</strong> ï¼‰ åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨Â volatileÂ ä»£æ›¿Â synchronizedÂ æ¥ä¼˜åŒ–ä»£ç æå‡æ•ˆç‡ã€‚</p>
<h4 id="834-é”ä¼˜åŒ–">8.3.4 é”ä¼˜åŒ–
</h4><p>â€‹	synchronizedæ˜¯é‡é‡çº§é”ï¼Œæ•ˆç‡ä¸é«˜ã€‚ä½†åœ¨jdk 1.6ä¸­å¯¹synchronizeçš„å®ç°è¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œä½¿å¾—å®ƒæ˜¾å¾—ä¸æ˜¯é‚£ä¹ˆé‡äº†ã€‚jdk1.6å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚</p>
<p>â€‹	é”ä¸»è¦å­˜åœ¨å››ä¸­çŠ¶æ€ï¼Œä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼Œä»–ä»¬ä¼šéšç€ç«äº‰çš„æ¿€çƒˆè€Œé€æ¸å‡çº§ã€‚</p>
<p>==<strong>æ³¨æ„é”å¯ä»¥å‡çº§ä¸å¯é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</strong>==</p>
<h5 id="1-åå‘é”">1 åå‘é”
</h5><p>â€‹	æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹å»äº‰ç”¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹äº‰ç”¨ï¼Œåˆ™ä¼šå°è¯•CASå»ä¿®æ”¹mark wordä¸­ä¸€ä¸ªæ ‡è®°ä¸ºåå‘(mark wordå•ç‹¬æœ‰ä¸€ä¸ªbitè¡¨ç¤ºæ˜¯å¦å¯åå‘ï¼Œè®°å½•é”çš„ä½ç½®ä¾ç„¶ä¸º01)ï¼Œè¿™ä¸ªCASåŠ¨ä½œåŒæ—¶ä¼šä¿®æ”¹mark wordéƒ¨åˆ†bitä»¥ä¿ç•™çº¿ç¨‹çš„IDå€¼ã€‚</li>
<li>å½“çº¿ç¨‹ä¸æ–­å‘ç”Ÿé‡å…¥æ—¶ï¼Œåªéœ€è¦åˆ¤å®šå¤´éƒ¨çš„çº¿ç¨‹IDæ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œè‹¥æ˜¯ï¼Œåˆ™æ— éœ€ä»»ä½•æ“ä½œã€‚</li>
<li>==å¦‚æœåŒä¸€ä¸ªå¯¹è±¡å­˜åœ¨å¦ä¸€ä¸ªçº¿ç¨‹å‘èµ·äº†è®¿é—®è¯·æ±‚==ï¼Œåˆ™é¦–å…ˆä¼šåˆ¤å®šè¯¥å¯¹è±¡æ˜¯å¦å·²ç»è¢«é”å®šäº†ã€‚å¦‚æœå·²ç»è¢«é”å®šï¼Œåˆ™ä¼šå°†é”ä¿®æ”¹ä¸ºè½»é‡çº§é”(00),ä¹Ÿå°±æ˜¯é”ç²’åº¦ä¸Šå‡äº†ï¼›è€Œå¦‚æœæ²¡æœ‰é”å®šï¼Œåˆ™ä¼šå°†å¯¹è±¡çš„==æ˜¯å¦å¯åå‘çš„ä½ç½®è®¾ç½®ä¸ºä¸å¯åå‘==ã€‚</li>
</ul>
<p>â€‹    åå‘é”æ˜¯Java 6ä¹‹ååŠ å…¥çš„æ–°é”ï¼Œå®ƒæ˜¯ä¸€ç§é’ˆå¯¹åŠ é”æ“ä½œçš„ä¼˜åŒ–æ‰‹æ®µï¼Œç»è¿‡ç ”ç©¶å‘ç°ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œå› æ­¤ä¸ºäº†å‡å°‘åŒä¸€çº¿ç¨‹è·å–é”(ä¼šæ¶‰åŠåˆ°ä¸€äº›CASæ“ä½œ,è€—æ—¶)çš„ä»£ä»·è€Œå¼•å…¥åå‘é”ã€‚åå‘é”çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œ<strong>å¦‚æœä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œé‚£ä¹ˆé”å°±è¿›å…¥åå‘æ¨¡å¼ï¼Œæ­¤æ—¶Mark Word çš„ç»“æ„ä¹Ÿå˜ä¸ºåå‘é”ç»“æ„</strong>ï¼Œå½“è¿™ä¸ªçº¿ç¨‹å†æ¬¡è¯·æ±‚é”æ—¶ï¼Œæ— éœ€å†åšä»»ä½•åŒæ­¥æ“ä½œï¼Œå³è·å–é”çš„è¿‡ç¨‹ï¼Œè¿™æ ·å°±çœå»äº†å¤§é‡æœ‰å…³é”ç”³è¯·çš„æ“ä½œï¼Œä»è€Œä¹Ÿå°±æä¾›ç¨‹åºçš„æ€§èƒ½ã€‚æ‰€ä»¥ï¼Œå¯¹äºæ²¡æœ‰é”ç«äº‰çš„åœºåˆï¼Œåå‘é”æœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ•ˆæœï¼Œæ¯•ç«Ÿææœ‰å¯èƒ½è¿ç»­å¤šæ¬¡æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ç”³è¯·ç›¸åŒçš„é”ã€‚ä½†æ˜¯å¯¹äºé”ç«äº‰æ¯”è¾ƒæ¿€çƒˆçš„åœºåˆï¼Œåå‘é”å°±å¤±æ•ˆäº†ï¼Œå› ä¸ºè¿™æ ·åœºåˆææœ‰å¯èƒ½æ¯æ¬¡ç”³è¯·é”çš„çº¿ç¨‹éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œå› æ­¤è¿™ç§åœºåˆä¸‹ä¸åº”è¯¥ä½¿ç”¨åå‘é”ï¼Œå¦åˆ™ä¼šå¾—ä¸å¿å¤±ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåå‘é”å¤±è´¥åï¼Œå¹¶ä¸ä¼šç«‹å³è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œè€Œæ˜¯å…ˆå‡çº§ä¸ºè½»é‡çº§é”ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç€äº†è§£è½»é‡çº§é”ã€‚</p>
<h5 id="2-è½»é‡çº§é”">2 è½»é‡çº§é”
</h5><p>â€‹	synchronizedä¼šåœ¨å¯¹è±¡çš„å¤´éƒ¨æ‰“æ ‡è®°ï¼Œè¿™ä¸ªåŠ é”çš„åŠ¨ä½œæ˜¯å¿…é¡»è¦åšçš„ï¼Œæ‚²è§‚é”é€šå¸¸è¿˜ä¼šåšè®¸å¤šå…¶ä»–çš„æŒ‡ä»¤åŠ¨ä½œï¼Œè½»é‡çº§é”å¸Œæœ›é€šè¿‡CASå®ç°ï¼Œå®ƒè®¤ä¸ºé€šè¿‡CASå°è¯•ä¿®æ”¹å¯¹è±¡å¤´éƒ¨çš„markåŒºåŸŸçš„å†…å®¹å°±å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œç”±äºmarkåŒºåŸŸçš„å®½åº¦é€šå¸¸æ˜¯4~8å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºä¸€ä¸ªintæˆ–è€…longçš„å®½åº¦ï¼Œé€‚åˆäºCASæ“ä½œã€‚</p>
<p>è½»é‡çº§é”é€šå¸¸ä¼šåšä¸€ä¸‹4ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>==åœ¨æ ˆä¸­åˆ†é…ä¸€å—ç©ºé—´ç”¨æ¥åšä¸€ä»½å¯¹è±¡å¤´éƒ¨mark wordçš„æ‹·è´==ï¼Œåœ¨mark wordä¸­å°†å¯¹è±¡é”çš„äºŒè¿›åˆ¶ä½è®¾ç½®ä¸ºâ€œæœªé”å®šâ€(åœ¨32ä½çš„JVMä¸­é€šå¸¸æœ‰2ä½ç”¨äºå­˜å‚¨é”æ ‡è®°ï¼Œæœªé”å®šçš„æ ‡è®°ä¸º01)ï¼Œè¿™ä¸ªåŠ¨ä½œæ˜¯==æ–¹ä¾¿ç­‰åˆ°é‡Šæ”¾é”çš„æ—¶å€™å°†è¿™ä»½æ•°æ®æ‹·è´åˆ°å¯¹è±¡å¤´éƒ¨ã€‚==</li>
<li>é€šè¿‡CASå°è¯•å°†å¤´éƒ¨çš„äºŒè¿›åˆ¶ä½ä¿®æ”¹ä¸ºâ€œçº¿ç¨‹ç§æœ‰æ ˆä¸­å¯¹markåŒºåŸŸæ‹·è´å­˜æ”¾çš„åœ°å€â€ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™ä¼šå°†æœ€å2ä½è®¾ç½®ä¸º00ï¼Œä»£è¡¨å·²ç»è¢«è½»é‡çº§é”é”ä½äº†ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œåˆ™åˆ¤å®šå¯¹è±¡å¤´éƒ¨æ˜¯å¦å·²ç»æŒ‡å‘äº†å½“å‰çº¿ç¨‹æ‰€åœ¨çš„æ ˆå½“ä¸­ï¼Œå¦‚æœæˆç«‹åˆ™ä»£è¡¨å½“å‰çº¿ç¨‹å·²ç»æ˜¯æ‹¥æœ‰ç€ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</li>
<li>å¦‚æœä¸æ˜¯æ‹¥æœ‰ç€ï¼Œåˆ™è¯´æ˜æœ‰å¤šä¸ªçº¿ç¨‹åœ¨äº‰ç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šå°†==é”å‡çº§ä¸ºæ‚²è§‚é”ï¼Œçº¿ç¨‹è¿›å…¥BLOCKEDçŠ¶æ€ã€‚==</li>
</ul>
<p>â€‹    JVMå‘ç°åœ¨è½»é‡çº§é”é‡Œé¢å¤šæ¬¡â€œé‡å…¥â€å’Œâ€œé‡Šæ”¾â€æ—¶ï¼Œéœ€è¦åšçš„åˆ¤æ–­å’Œæ‹·è´åŠ¨ä½œè¿˜æ˜¯å¾ˆå¤šï¼Œè€Œåœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œé”å°±æ˜¯è¢«æŸä¸€ä¸ªçº¿ç¨‹ä¸€ç›´ä½¿ç”¨ï¼Œä¸ºäº†è¿›ä¸€æ­¥å‡å°é”çš„å¼€é”€ï¼ŒJVMä¸­å‡ºç°äº†åå‘é”ï¼Œåå‘é”å¸Œæœ›è®°å½•çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹IDï¼Œå®ƒæ¯”è½»é‡çº§é”æ›´åŠ è½»é‡ï¼Œå½“å†æ¬¡é‡å…¥åˆ¤å®šæ—¶ï¼Œé¦–å…ˆåˆ¤å®šå¯¹è±¡å¤´éƒ¨çš„çº¿ç¨‹IDæ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œè‹¥æ˜¯åˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æ˜¯å¯¹è±¡é”çš„OWNERï¼Œæ— é¡»åšå…¶ä»–ä»»ä½•åŠ¨ä½œã€‚</p>
<h5 id="3-è‡ªæ—‹é”">3 è‡ªæ—‹é”
</h5><p>â€‹	 è½»é‡çº§é”å¤±è´¥åï¼Œè™šæ‹Ÿæœºä¸ºäº†é¿å…çº¿ç¨‹çœŸå®åœ°åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŒ‚èµ·ï¼Œè¿˜ä¼šè¿›è¡Œä¸€é¡¹ç§°ä¸ºè‡ªæ—‹é”çš„ä¼˜åŒ–æ‰‹æ®µã€‚è¿™æ˜¯åŸºäº åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ å¯¹è±¡é”çš„é”çŠ¶æ€åªä¼š<strong>æŒç»­å¾ˆçŸ­ä¸€æ®µæ—¶é—´</strong>ï¼Œä¸ºäº†è¿™ä¸€æ®µå¾ˆçŸ­çš„æ—¶é—´é¢‘ç¹åœ°é˜»å¡å’Œå”¤é†’çº¿ç¨‹æ˜¯éå¸¸ä¸å€¼å¾—çš„ã€‚æ‰€ä»¥å¼•å…¥è‡ªæ—‹é”ã€‚</p>
<p>â€‹	æ‰€è°“==è‡ªæ—‹é”ï¼Œå°±æ˜¯è®©è¯¥çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸ä¼šè¢«ç«‹å³æŒ‚èµ·ï¼Œçœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦ä¼šå¾ˆå¿«é‡Šæ”¾é”ã€‚æ€ä¹ˆç­‰å¾…å‘¢ï¼Ÿæ‰§è¡Œä¸€æ®µæ— æ„ä¹‰çš„å¾ªç¯å³å¯ï¼ˆè‡ªæ—‹ï¼‰ã€‚==</p>
<p>â€‹	==è‡ªæ—‹ç­‰å¾…ä¸èƒ½æ›¿ä»£é˜»å¡ï¼Œè™½ç„¶å®ƒå¯ä»¥é¿å…çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„å¼€é”€==ï¼Œä½†æ˜¯å®ƒå ç”¨äº†å¤„ç†å™¨çš„æ—¶é—´ã€‚==å¦‚æœæŒæœ‰é”çš„çº¿ç¨‹å¾ˆå¿«å°±é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„æ•ˆç‡å°±éå¸¸å¥½ï¼Œåä¹‹ï¼Œè‡ªæ—‹çš„çº¿ç¨‹å°±ä¼šç™½ç™½æ¶ˆè€—æ‰å¤„ç†çš„èµ„æºï¼Œå®ƒä¸ä¼šåšä»»ä½•æœ‰æ„ä¹‰çš„å·¥ä½œï¼Œå…¸å‹çš„å ç€èŒ…å‘ä¸æ‹‰å±ï¼Œè¿™æ ·åè€Œä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„æµªè´¹==ã€‚æ‰€ä»¥è¯´ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´ï¼ˆè‡ªæ—‹çš„æ¬¡æ•°ï¼‰å¿…é¡»è¦æœ‰ä¸€ä¸ªé™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†å®šä¹‰çš„æ—¶é—´ä»ç„¶æ²¡æœ‰è·å–åˆ°é”ï¼Œåˆ™åº”è¯¥è¢«æŒ‚èµ·ã€‚</p>
<p>â€‹	è‡ªæ—‹é”åœ¨JDK 1.4.2ä¸­å¼•å…¥ï¼Œé»˜è®¤å…³é—­ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨-XX:+UseSpinningå¼€å¼€å¯ï¼Œåœ¨JDK1.6ä¸­é»˜è®¤å¼€å¯ã€‚åŒæ—¶è‡ªæ—‹çš„é»˜è®¤æ¬¡æ•°ä¸º10æ¬¡ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-XX:PreBlockSpinæ¥è°ƒæ•´ï¼›</p>
<p>â€‹	å¦‚æœé€šè¿‡å‚æ•°-XX:preBlockSpinæ¥è°ƒæ•´è‡ªæ—‹é”çš„è‡ªæ—‹æ¬¡æ•°ï¼Œä¼šå¸¦æ¥è¯¸å¤šä¸ä¾¿ã€‚å‡å¦‚æˆ‘å°†å‚æ•°è°ƒæ•´ä¸º10ï¼Œä½†æ˜¯ç³»ç»Ÿå¾ˆå¤šçº¿ç¨‹éƒ½æ˜¯ç­‰ä½ åˆšåˆšé€€å‡ºçš„æ—¶å€™å°±é‡Šæ”¾äº†é”ï¼ˆå‡å¦‚ä½ å¤šè‡ªæ—‹ä¸€ä¸¤æ¬¡å°±å¯ä»¥è·å–é”ï¼‰ï¼Œä½ æ˜¯ä¸æ˜¯å¾ˆå°´å°¬ã€‚äºæ˜¯JDK1.6å¼•å…¥è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼Œè®©è™šæ‹Ÿæœºä¼šå˜å¾—è¶Šæ¥è¶Šèªæ˜ã€‚</p>
<h5 id="4-é€‚åº”è‡ªæ—‹é”">4 é€‚åº”è‡ªæ—‹é”
</h5><p>â€‹	JDK 1.6å¼•å…¥äº†æ›´åŠ èªæ˜çš„è‡ªæ—‹é”ï¼Œå³è‡ªé€‚åº”è‡ªæ—‹é”ã€‚æ‰€è°“è‡ªé€‚åº”å°±æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†æ˜¯å›ºå®šçš„ï¼Œ==å®ƒæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å®ƒæ€ä¹ˆåšå‘¢ï¼Ÿçº¿ç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œé‚£ä¹ˆä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´åŠ å¤šï¼Œå› ä¸ºè™šæ‹Ÿæœºè®¤ä¸ºæ—¢ç„¶ä¸Šæ¬¡æˆåŠŸäº†ï¼Œé‚£ä¹ˆæ­¤æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½ä¼šå†æ¬¡æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­çš„æ¬¡æ•°æ›´å¤š==ã€‚åä¹‹ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œå¾ˆå°‘æœ‰è‡ªæ—‹èƒ½å¤ŸæˆåŠŸçš„ï¼Œé‚£ä¹ˆåœ¨ä»¥åè¦æˆ–è€…è¿™ä¸ªé”çš„æ—¶å€™è‡ªæ—‹çš„æ¬¡æ•°ä¼šå‡å°‘ç”šè‡³çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚</p>
<p>æœ‰äº†è‡ªé€‚åº”è‡ªæ—‹é”ï¼Œéšç€ç¨‹åºè¿è¡Œå’Œæ€§èƒ½ç›‘æ§ä¿¡æ¯çš„ä¸æ–­å®Œå–„ï¼Œè™šæ‹Ÿæœºå¯¹ç¨‹åºé”çš„çŠ¶å†µé¢„æµ‹ä¼šè¶Šæ¥è¶Šå‡†ç¡®ï¼Œè™šæ‹Ÿæœºä¼šå˜å¾—è¶Šæ¥è¶Šèªæ˜ã€‚</p>
<h5 id="5-é”æ¶ˆé™¤">5 é”æ¶ˆé™¤
</h5><p>â€‹	ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ“ä½œæ—¶éœ€è¦å¯¹è¿™éƒ¨åˆ†æ“ä½œè¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œ==JVMæ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰ï¼Œè¿™æ˜¯JVMä¼šå¯¹è¿™äº›åŒæ­¥é”è¿›è¡Œé”æ¶ˆé™¤ã€‚é”æ¶ˆé™¤çš„ä¾æ®æ˜¯é€ƒé€¸åˆ†æçš„æ•°æ®æ”¯æŒã€‚==</p>
<p>â€‹	å¦‚æœä¸å­˜åœ¨ç«äº‰ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åŠ é”å‘¢ï¼Ÿæ‰€ä»¥é”æ¶ˆé™¤å¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”çš„æ—¶é—´ã€‚==å˜é‡æ˜¯å¦é€ƒé€¸ï¼Œå¯¹äºè™šæ‹Ÿæœºæ¥è¯´éœ€è¦ä½¿ç”¨æ•°æ®æµåˆ†ææ¥ç¡®å®š==ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬ç¨‹åºå‘˜æ¥è¯´è¿™è¿˜ä¸æ¸…æ¥šä¹ˆï¼Ÿæˆ‘ä»¬ä¼šåœ¨æ˜æ˜çŸ¥é“ä¸å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç å—å‰åŠ ä¸ŠåŒæ­¥å—ï¼Ÿä½†æ˜¯æœ‰æ—¶å€™ç¨‹åºå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³çš„é‚£æ ·ï¼Ÿæˆ‘ä»¬è™½ç„¶æ²¡æœ‰æ˜¾ç¤ºä½¿ç”¨é”ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸€äº›JDKçš„å†…ç½®APIæ—¶ï¼Œå¦‚StringBufferã€Vectorã€HashTableç­‰ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå­˜åœ¨éšå½¢çš„åŠ é”æ“ä½œã€‚æ¯”å¦‚StringBufferçš„append()æ–¹æ³•ï¼ŒVectorçš„add()æ–¹æ³•ï¼š</p>
<pre><code class="language-java">public void test(){
    Vector&lt;Integer&gt; vector = new Vector&lt;Integer&gt;();
    for(int i = 0 ; i &lt; 10 ; i++){
        vector.add(i);
    }
    System.out.println(vector);
}
</code></pre>
<p>â€‹	åœ¨è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒJVMå¯ä»¥æ˜æ˜¾æ£€æµ‹åˆ°å˜é‡vectoræ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•vectorTest()ä¹‹å¤–ï¼Œæ‰€ä»¥JVMå¯ä»¥å¤§èƒ†åœ°å°†vectorå†…éƒ¨çš„åŠ é”æ“ä½œæ¶ˆé™¤ã€‚</p>
<h5 id="6-é”ç²—åŒ–">6 é”ç²—åŒ–
</h5><p>â€‹	åœ¨ä½¿ç”¨åŒæ­¥é”çš„æ—¶å€™ï¼Œéœ€è¦è®©åŒæ­¥å—çš„ä½œç”¨èŒƒå›´å°½å¯èƒ½å°ï¼Œä»…åœ¨å…±äº«æ•°æ®çš„å®é™…ä½œç”¨åŸŸä¸­æ‰è¿›è¡ŒåŒæ­¥ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä½¿éœ€è¦åŒæ­¥çš„æ“ä½œé‡å°½å¯èƒ½ç¼©å°ï¼Œå¦‚æœå­˜åœ¨é”ç«äº‰ï¼Œé‚£ä¹ˆç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿèƒ½å°½å¿«æ‹¿åˆ°é”ã€‚</p>
<p>â€‹	åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°è§‚ç‚¹æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­åŠ é”è§£é”æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥å¼•å…¥é”ç²—åŒ–çš„æ¦‚å¿µã€‚</p>
<p>â€‹	é”ç²—è¯æ¦‚å¿µæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å°†å¤šä¸ªè¿ç»­çš„åŠ é”ã€è§£é”æ“ä½œè¿æ¥åœ¨ä¸€èµ·ï¼Œæ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚å¦‚ä¸Šé¢å®ä¾‹ï¼švectoræ¯æ¬¡addçš„æ—¶å€™éƒ½éœ€è¦åŠ é”æ“ä½œï¼ŒJVMæ£€æµ‹åˆ°å¯¹åŒä¸€ä¸ªå¯¹è±¡ï¼ˆvectorï¼‰è¿ç»­åŠ é”ã€è§£é”æ“ä½œï¼Œä¼šåˆå¹¶ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„åŠ é”ã€è§£é”æ“ä½œï¼Œå³åŠ é”è§£é”æ“ä½œä¼šç§»åˆ°forå¾ªç¯ä¹‹å¤–ã€‚</p>
<pre><code class="language-java">Vector&lt;Integer&gt; vector = new Vector&lt;Integer&gt;();
public void test(){
    //åŠ é”
    for(int i = 0 ; i &lt; 10 ; i++){
        vector.add(i);//1.åŠ é” 2.è§£é”
    }
    //è§£é”
    System.out.println(vector);
}
</code></pre>
<h5 id="7-é‡é‡é”">7 é‡é‡é”
</h5><p>â€‹	  javaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ï¼Œå¦‚æœè¦é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹å°±éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œéœ€è¦åœ¨ç”¨æˆ·æ€ä¸æ ¸å¿ƒæ€ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ç§åˆ‡æ¢ä¼šæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„æºï¼Œå› ä¸º<strong>ç”¨æˆ·æ€ä¸å†…æ ¸æ€</strong>éƒ½æœ‰å„è‡ªä¸“ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä¸“ç”¨çš„å¯„å­˜å™¨ç­‰ï¼Œç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€éœ€è¦<strong>ä¼ é€’ç»™è®¸å¤šå˜é‡ã€å‚æ•°ç»™å†…æ ¸</strong>ï¼Œå†…æ ¸ä¹Ÿéœ€è¦ä¿æŠ¤å¥½ç”¨æˆ·æ€åœ¨åˆ‡æ¢æ—¶çš„ä¸€äº›å¯„å­˜å™¨å€¼ã€å˜é‡ç­‰ï¼Œä»¥ä¾¿å†…æ ¸æ€è°ƒç”¨ç»“æŸååˆ‡æ¢å›ç”¨æˆ·æ€ç»§ç»­å·¥ä½œã€‚</p>
<p>â€‹    å› ä¸ºéœ€è¦é™åˆ¶ä¸åŒçš„ç¨‹åºä¹‹é—´çš„è®¿é—®èƒ½åŠ›, é˜²æ­¢ä»–ä»¬è·å–åˆ«çš„ç¨‹åºçš„å†…å­˜æ•°æ®, æˆ–è€…è·å–å¤–å›´è®¾å¤‡çš„æ•°æ®, å¹¶å‘é€åˆ°ç½‘ç»œ, CPUåˆ’åˆ†å‡ºä¸¤ä¸ªæƒé™ç­‰çº§ :ç”¨æˆ·æ€ å’Œ å†…æ ¸æ€</p>
<ul>
<li>å†…æ ¸æ€ï¼šCPUå¯ä»¥è®¿é—®å†…å­˜æ‰€æœ‰æ•°æ®, åŒ…æ‹¬å¤–å›´è®¾å¤‡, ä¾‹å¦‚ç¡¬ç›˜, ç½‘å¡. CPUä¹Ÿå¯ä»¥å°†è‡ªå·±ä»ä¸€ä¸ªç¨‹åºåˆ‡æ¢åˆ°å¦ä¸€ä¸ªç¨‹åº</li>
<li>ç”¨æˆ·æ€ï¼šåªèƒ½å—é™çš„è®¿é—®å†…å­˜, ä¸”ä¸å…è®¸è®¿é—®å¤–å›´è®¾å¤‡. å ç”¨CPUçš„èƒ½åŠ›è¢«å‰¥å¤º, CPUèµ„æºå¯ä»¥è¢«å…¶ä»–ç¨‹åºè·å–</li>
</ul>
<p>â€‹    æ‰€æœ‰ç”¨æˆ·ç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€çš„, ä½†æ˜¯æœ‰æ—¶å€™ç¨‹åºç¡®å®éœ€è¦åšä¸€äº›å†…æ ¸æ€çš„äº‹æƒ…, ä¾‹å¦‚ä»ç¡¬ç›˜è¯»å–æ•°æ®, æˆ–è€…ä»é”®ç›˜è·å–è¾“å…¥ç­‰.ï¼Œè€Œå”¯ä¸€å¯ä»¥åšè¿™äº›äº‹æƒ…çš„å°±æ˜¯æ“ä½œç³»ç»Ÿ, æ‰€ä»¥æ­¤æ—¶ç¨‹åºå°±éœ€è¦å…ˆæ“ä½œç³»ç»Ÿè¯·æ±‚ä»¥ç¨‹åºçš„åä¹‰æ¥æ‰§è¡Œè¿™äº›æ“ä½œï¼ˆæ¯”å¦‚javaçš„I/Oæ“ä½œåº•å±‚éƒ½æ˜¯é€šè¿‡nativeæ–¹æ³•æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿï¼‰ã€‚è¿™æ—¶éœ€è¦ä¸€ä¸ªè¿™æ ·çš„æœºåˆ¶: ç”¨æˆ·æ€ç¨‹åºåˆ‡æ¢åˆ°å†…æ ¸æ€, ä½†æ˜¯ä¸èƒ½æ§åˆ¶åœ¨å†…æ ¸æ€ä¸­æ‰§è¡Œçš„æŒ‡ä»¤ã€‚è¿™ç§æœºåˆ¶å«ç³»ç»Ÿè°ƒç”¨, åœ¨CPUä¸­çš„å®ç°ç§°ä¹‹ä¸ºé™·é˜±æŒ‡ä»¤(Trap Instruction)ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“
</h3><ol>
<li>
<p>çº¿ç¨‹å’Œè¿›ç¨‹åŒºåˆ«</p>
<ol>
<li>è¿›ç¨‹ç‹¬äº«å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«å †å†…å­˜ç©ºé—´ï¼Œç‹¬äº«æ ˆå†…å­˜ç©ºé—´</li>
<li>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡è¿è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½åŒ…å«å¾ˆå¤šçº¿ç¨‹ï¼Œçº¿ç¨‹æ˜¯ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œçš„æœ€å°å•å…ƒã€‚</li>
</ol>
</li>
<li>
<p><strong>å¤šçº¿ç¨‹åˆ›å»º</strong></p>
<ol>
<li>ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•</li>
<li>å®ç°runableæ¥å£ï¼Œå®ç°runæ–¹æ³•</li>
<li>åŒ¿åå†…éƒ¨ç±»å®ç°runableæ¥å£</li>
</ol>
</li>
<li>
<p><strong>å¤šçº¿ç¨‹åˆ›å»ºæ–¹å¼æ³¨æ„çš„ç‚¹</strong></p>
<ol>
<li>å®ç°runableæ¥å£å¯ä»¥è®©å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œç»§æ‰¿Threadç±»æ–¹å¼ä¸è¡Œ</li>
<li>çº¿ç¨‹åˆ›å»ºåè¦é€šè¿‡startæ–¹æ³•è¿è¡Œï¼Œé€šè¿‡æœ¬åœ°nativeæ–¹æ³•è°ƒç”¨åº•å±‚cåŒåæ–¹æ³•åˆ›å»ºçº¿ç¨‹æ‰§è¡Œï¼Œä¸è¦é€šè¿‡runæ–¹æ³•ï¼Œå› ä¸ºrunæ–¹æ³•ç›¸å½“äºåœ¨ä¸»çº¿ç¨‹è¿è¡Œç±»çš„runæ–¹æ³•è€Œå·²ï¼Œä¸ä¼šåˆ›å»ºçº¿ç¨‹æ‰§è¡Œ</li>
</ol>
</li>
<li>
<p>çº¿ç¨‹å®‰å…¨ï¼ˆå¤šçº¿ç¨‹æ‰§è¡ŒåŒä¸€æ®µä»£ç ï¼Œå¦‚æœå‘ç”Ÿå’Œé¢„æœŸç»“æœä¸ä¸€è‡´çš„æƒ…å†µå°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼‰</p>
<ol>
<li>ç”±äºä¸æ»¡è¶³åŸå­æ€§ï¼Œæœ‰åºæ€§ï¼Œå¯è§æ€§å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šåŠ é”è§£å†³</li>
<li>æ­»é”ï¼šçº¿ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”äº§ç”Ÿæ­»é”ã€‚è§£å†³æ–¹æ¡ˆï¼šä¸è¦åœ¨åŒæ­¥ä¸­åµŒå¥—åŒæ­¥</li>
</ol>
</li>
<li>
<p>çº¿ç¨‹åŒæ­¥æ–¹å¼Synchorizedï¼ˆSynchorizedéƒ½æ˜¯å¯¹å¯¹è±¡åŠ é”ï¼‰</p>
<ol>
<li>åŒæ­¥ä»£ç å—åŠ é” sync&hellip;(obj)-&gt;å¯¹objå¯¹è±¡åŠ é”</li>
<li>åŒæ­¥æ–¹æ³• sync fun01-&gt;å¯¹thiså¯¹è±¡åŠ é”</li>
<li>é™æ€åŒæ­¥æ–¹æ³• static sync fun02-&gt;å¯¹å½“å‰ç±»çš„classåŠ é”</li>
</ol>
</li>
<li>
<p>çº¿ç¨‹çŠ¶æ€</p>
<ol>
<li>newï¼ˆæ–°å»ºçº¿ç¨‹æœªæ‰§è¡Œï¼‰</li>
<li>runableï¼ˆå¯è¿è¡Œï¼‰ï¼šç”±readyï¼ˆå°±ç»ªï¼‰å’Œrunningï¼ˆè¿è¡Œä¸­ï¼‰ä¸¤ä¸ªçŠ¶æ€ç»„æˆ,çŠ¶æ€çš„åˆ‡æ¢æ˜¯ç”±cpuè°ƒåº¦åˆ‡æ¢çš„ï¼Œcpuè°ƒåº¦åˆ°è¯¥çº¿ç¨‹ï¼Œå°±æ˜¯runningï¼Œæ²¡è°ƒåº¦åˆ°å°±æ˜¯ready</li>
<li>waitingï¼šç”±å½“å‰è·å–åˆ°é”çš„çº¿ç¨‹ï¼Œé”å¯¹è±¡.wait()æ–¹æ³•å¼•èµ·çš„ï¼Œåªèƒ½ç”±åŒä¸€ä¸ªå¯¹è±¡çš„notifyï¼ˆï¼‰/nodifyAll()æ–¹æ³•å”¤é†’</li>
<li>timed_waiting: sleepï¼ˆæ—¶é—´ï¼‰ï¼Œwaitï¼ˆæ—¶é—´ï¼‰ï¼Œåˆ°è¾¾æ—¶é—´åè‡ªåŠ¨å”¤é†’</li>
<li>blockedï¼šçº¿ç¨‹è·å–ä¸åˆ°é”å°±è¿›å…¥é˜»å¡çŠ¶æ€</li>
<li>TERMINATEDï¼šçº¿ç¨‹ç»ˆæ­¢</li>
</ol>
</li>
<li>
<p><strong>waitå’ŒsleepåŒºåˆ«</strong></p>
<ol>
<li>waitæ˜¯å±äºObjectç±»çš„ï¼Œsleepæ˜¯å±äºThreadç±»çš„</li>
<li>waitä¼šè®©æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œå¹¶è¿›å…¥waitingçŠ¶æ€ï¼Œsleepæ˜¯ä¸ä¼šé‡Šæ”¾é”çš„ï¼Œå¿…é¡»æœ‰ç­‰å¾…æ—¶é—´ï¼Œæ—¶é—´è¿‡åç»§ç»­æ‰§è¡Œ</li>
</ol>
</li>
<li>
<p>çº¿ç¨‹åœæ­¢</p>
<ol>
<li>é€šè¿‡è‡ªå®šä¹‰æ ‡è¯†ï¼šç¼ºç‚¹æ˜¯çº¿ç¨‹sleepæƒ…å†µä¸‹ä¸èƒ½è¢«ç«‹åˆ»åœæ­¢</li>
<li>é€šè¿‡çº¿ç¨‹è‡ªå¸¦æ ‡è¯†ï¼š
<ol>
<li>å½“å‰çº¿ç¨‹æ­£å¸¸æ‰§è¡Œï¼šThread.currentThread().isInterrupt()åˆ¤æ–­ä¸ºtrueé€€å‡º</li>
<li>å½“å‰çº¿ç¨‹sleepï¼šä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ•è·åé€€å‡º</li>
</ol>
</li>
</ol>
</li>
<li>
<p>çº¿ç¨‹ä¼˜å…ˆçº§</p>
<ol>
<li>ä»1-10ï¼Œè¡¨ç¤ºçš„æ˜¯cpuè°ƒåº¦åˆ°è¯¥çº¿ç¨‹çš„æ¦‚ç‡ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šæœ‰å¯èƒ½è¢«è°ƒåº¦åˆ°ï¼Œé»˜è®¤å€¼æ˜¯5ï¼Œåœ¨å®è§‚è§’åº¦æ¥çœ‹å°±æ˜¯å ç”¨cpuæ—¶é—´ç‰‡çš„å¤šå°‘</li>
<li>joinï¼šåœ¨çº¿ç¨‹bè¿è¡Œçš„æ—¶å€™æ‰§è¡Œçº¿ç¨‹a.join,aå…ˆæ‰§è¡Œæ‰§è¡Œå®Œäº†æ‰§è¡Œb</li>
<li>yieldï¼šå°†å½“å‰è¿è¡Œçº¿ç¨‹running-&gt;readyï¼Œä½†æ˜¯å¯èƒ½æ²¡æ•ˆæœï¼Œè¯¥çº¿ç¨‹å¯èƒ½è¢«å†æ¬¡è°ƒåº¦</li>
</ol>
</li>
<li>
<p>ä¿è¯çº¿ç¨‹å®‰å…¨çš„ä¸‰ä¸ªç‰¹æ€§</p>
<ol>
<li>åŸå­æ€§ï¼šçº¿ç¨‹æ‰§è¡Œä¸€æ®µä»£ç çš„è¿‡ç¨‹ä¸­ä¸èƒ½è¢«å…¶ä»–çš„çº¿ç¨‹å¹²æ‰°å¯¹ç»“æœäº§ç”Ÿå½±å“ã€‚</li>
<li>å¯è§æ€§ï¼šçº¿ç¨‹ä¿®æ”¹äº†å˜é‡ä¹‹åèƒ½å¤Ÿç«‹åˆ»è¢«å…¶ä»–çº¿ç¨‹çœ‹è§</li>
<li>æœ‰åºæ€§ï¼šç”±jvmæŒ‡ä»¤é‡æ’åºå¯¼è‡´çš„ï¼ŒjvmæŒ‡ä»¤é‡æ’èƒ½å¤Ÿä¿è¯åœ¨å•çº¿ç¨‹æ‰§è¡Œä¸‹ç»“æœä¸€è‡´ï¼Œå¤šçº¿ç¨‹ä¸èƒ½ä¿è¯ã€‚</li>
</ol>
</li>
<li>
<p>jvmå†…å­˜ç»“æ„ï¼šjvmè¿è¡Œæ—¶çš„åŒºåŸŸåˆ’åˆ†</p>
</li>
<li>
<p>javaå¯¹è±¡æ¨¡å‹ï¼šå¯¹è±¡åœ¨jvmå†…å­˜ä¸­çš„å­˜å‚¨</p>
</li>
<li>
<p>å†…å­˜æ¨¡å‹ï¼šjmmä¸æ˜¯çœŸå®å­˜åœ¨çš„æ˜¯è™šæ‹Ÿçš„ï¼Œå®ƒçš„è¯­æ³•é›†æ˜ å°„åœ¨javaè¯­è¨€ä¸­å°±æ˜¯volidateï¼Œsynchronized</p>
</li>
<li>
<p>synchronized</p>
<ol>
<li>ä¿è¯åŸå­æ€§ï¼šå› ä¸ºè¢«synchronizedåŒ…è£¹çš„ä»£ç ï¼Œåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°</li>
<li>ä¿è¯å¯è§æ€§ï¼šåœ¨åŠ é”æ—¶ï¼Œä¼šæ¸…ç©ºæœ¬åœ°å†…å­˜å˜é‡ï¼Œè§£é”çš„æ—¶å€™ä¼šæŠŠä¿®æ”¹çš„æœ¬åœ°å†…å­˜å˜é‡åˆ·åˆ°ä¸»å†…å­˜é‡Œé¢å»</li>
<li>ä¿è¯æœ‰åºæ€§ï¼šå› ä¸ºè¢«synchronizedåŒ…è£¹çš„ä»£ç ï¼Œåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ,jvmæŒ‡ä»¤é‡æ’çš„ç»“æœå¯¹å•çº¿ç¨‹æ²¡æœ‰å½±å“ï¼Œå°±ç®—å‘ç”Ÿäº†æŒ‡ä»¤é‡æ’å¯¹synchronizedåŒ…è£¹çš„ä»£ç ä¹Ÿä¸ä¼šæœ‰å½±å“</li>
<li>åŠ é”ï¼šå¯¹è±¡çš„moniterEnterå’ŒmoniterExitåŠ é”å’Œè§£é”</li>
</ol>
</li>
<li>
<p>é”ä¼˜åŒ–</p>
<ol>
<li>è‡ªæ—‹é”ï¼šå¾ªç¯</li>
<li>é€‚åº”è‡ªæ—‹é”ï¼šå¾ªç¯ï¼ŒæˆåŠŸï¼Œç»™é”å¤šå¾ªç¯å‡ æ¬¡çš„æœºä¼šï¼Œå¤±è´¥åˆ™å‡å°‘æœºä¼šï¼Œå¦‚æœå¤šæ¬¡å¤±è´¥å°±ç›´æ¥è¿›å…¥é‡é‡çº§é”</li>
<li>é”æ¶ˆé™¤ï¼šå¦‚æœjvmæ£€æµ‹åˆ°é”æ²¡æœ‰ç«äº‰å°±æŠŠé”æ¶ˆé™¤äº†</li>
<li>é”ç²—åŒ–ï¼šæŠŠä¸€ä¸ªä¸ªå°çš„é”æ¢æˆä¸€ä¸ªå¤§é”</li>
<li>åå‘é”ï¼šåœ¨markWordä¸­ä¿å­˜threadidï¼Œå‘ç”Ÿç«äº‰å°±å‡çº§</li>
<li>è½»é‡çº§é”ï¼šé€šè¿‡caså®ç°</li>
<li>é‡é‡çº§é”ï¼šåŠ é”è§£é”ä¼šå¯¼è‡´çº¿ç¨‹ä»ç”¨æˆ·æ€åˆ°æ ¸å¿ƒæ€çš„åˆ‡æ¢ï¼Œæ¶ˆè€—æ¯”è¾ƒå¤§çš„èµ„æºã€‚</li>
</ol>
</li>
<li>
<p><strong>i++ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong></p>
<ol>
<li>æŠŠå˜é‡è¯»åˆ°cpuç¼“å­˜</li>
<li>æ“ä½œç¼“å­˜ä¸­çš„å€¼++</li>
<li>å†™å›ä¸»å†…å­˜</li>
<li>ç”±äºä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ä¸æ˜¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ol>
</li>
</ol>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">å¹¶å‘ç¼–ç¨‹</a>
        
            <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">å¤šçº¿ç¨‹</a>
        
            <a href="/tags/juc/">JUC</a>
        
            <a href="/tags/%E8%BD%AC%E8%BD%BD/">è½¬è½½</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2025 LexqinMike
    </section>
    
    <section class="powerby">
        
            ä½ æ°¸è¿œä¸çŸ¥é“ï¼Œæˆ‘çš„ä»£ç é‡Œè—äº†å¤šå°‘æ•…äº‹ã€‚ <br/>
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<div id="particles-js"></div>

<script src=https://mikeLing-qx.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://mikeLing-qx.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>

<style>
  body {
    background: url(https://mikeLing-qx.github.io/background/background-01.png) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
		<script>hljs.highlightAll();</script>
    </body>
</html>
